# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 專案概述

這是一個 ACGN（動畫、漫畫、遊戲、輕小說）翻譯網站專案，主要功能包含：
- 輕小說翻譯內容管理和展示
- 網漫翻譯功能
- 靜態網站服務系統
- 自動化內容更新和發布工具

## 開發環境

### 必要需求
- Python 3.6+ （推薦 3.8+）
- Git
- 現代網頁瀏覽器

### 啟動本地開發服務器
```bash
python 啟動伺服器.py
```
這將：
1. 自動生成小說索引 (`novels.json`)
2. 啟動 HTTP 服務器
3. 自動開啟瀏覽器到指定頁面

## 核心腳本和工具

### `啟動伺服器.py`
- **功能**: 本地開發 HTTP 服務器
- **特點**: 
  - 自動終止舊服務器進程
  - 支援選擇不同 HTML 檔案
  - UTF-8 編碼支援
  - 多線程服務
- **用法**: 直接執行，選擇要服務的 HTML 檔案

### `自動更新.py`
- **功能**: GitHub 自動更新和發布工具
- **流程**:
  1. 生成輕小說索引
  2. 檢查 Git 狀態
  3. 智能過濾檔案（自動忽略 `.claude/` 和 `CLAUDE.md`）
  4. 選擇性添加變更檔案
  5. 生成 commit 訊息
  6. 推送到 GitHub
- **用法**: 雙擊執行或命令行運行
- **智能過濾**: 自動忽略 Claude Code 相關檔案和常見臨時檔案

### `輕小說翻譯/generate_novels.py`
- **功能**: 掃描小說目錄並生成 JSON 索引
- **輸出**: `novels.json` - 包含所有小說的元資料
- **處理內容**: 標題、作者、標籤、章節、字數統計等

### `網漫翻譯/manga_scanner.py`
- **功能**: 掃描漫畫目錄並生成索引
- **輸出**: `manga.json`

### `通用自動更新.py`
- **功能**: 通用 GitHub 自動更新工具
- **特點**: 支援任何 Git 專案，無需特定配置，包含智能推送衝突處理
- **參數**: 
  - `--dry-run`: 預覽模式
  - `--message`: 自訂 commit 訊息
  - `--branch`: 指定分支
  - `--no-add`: 只處理已暫存檔案
  - `--auto-pull`: 推送失敗時自動拉取遠端變更
  - `--debug`: 顯示調試信息
- **衝突處理**: 自動檢測推送衝突並提供解決方案
- **使用範例**:
  ```bash
  # 基本使用
  python 通用自動更新.py
  
  # 自動處理推送衝突
  python 通用自動更新.py --auto-pull
  
  # 預覽模式
  python 通用自動更新.py --dry-run
  
  # 自訂 commit 訊息
  python 通用自動更新.py -m "Fix bug in user authentication"
  ```

## 專案結構

### 輕小說翻譯目錄結構
```
輕小說翻譯/
├── 《作品名稱》/
│   ├── 00 簡介.md          # 必須包含作者、類型、描述
│   ├── 0 譯名.md           # 人物和地名譯名對照
│   ├── [數字] 章節標題.md  # 章節內容檔案
│   └── cover.jpg           # 封面圖片
├── generate_novels.py      # 索引生成腳本
├── novels.json            # 自動生成的索引檔案
├── 指令提示詞.txt          # AI 翻譯提示詞
└── 譯名提示詞.txt          # 譯名規則說明
```

### 網漫翻譯目錄結構
```
網漫翻譯/
├── [漫畫名稱]/
│   ├── @簡介.md           # 漫畫簡介和資訊
│   └── [章節檔案]
├── manga_scanner.py       # 漫畫掃描腳本
└── manga.json            # 自動生成的漫畫索引
```

## 檔案命名規範

### 輕小說章節檔案
- 格式: `[章節號] 章節標題.md`
- 章節號支援小數（如 `45.5` 表示番外）
- 特殊檔案:
  - `00 簡介.md`: 作品簡介和元資料
  - `0 譯名.md`: 人物和專有名詞譯名對照表

### 簡介檔案格式
```markdown
作者：[作者名稱]
類型：[標籤1, 標籤2, 標籤3]
原始URL：[原作連結]

[作品描述內容]
```

## 常用開發任務

### 添加新的輕小說作品
1. 在 `輕小說翻譯/` 下創建新目錄 `《作品名稱》/`
2. 添加 `00 簡介.md` 和 `0 譯名.md`
3. 添加章節 Markdown 檔案
4. 放置 `cover.jpg` 封面圖片
5. 運行 `python 輕小說翻譯/generate_novels.py` 更新索引

### 更新作品索引
```bash
cd 輕小說翻譯
python generate_novels.py
```

### 測試網站變更
```bash
python 啟動伺服器.py
```
選擇要測試的 HTML 檔案

### 發布更新到 GitHub
```bash
python 自動更新.py
```
或直接雙擊執行

## 翻譯工作流程

### AI 翻譯提示詞
- 主要提示詞在 `輕小說翻譯/指令提示詞.txt`
- 譯名規則在 `輕小說翻譯/譯名提示詞.txt`
- 要求使用繁體中文翻譯
- 保持原文情感氛圍和語調

### 章節處理流程
1. 翻譯原始日文內容
2. 根據譯名對照表統一人物和地名
3. 使用 Markdown 格式保存
4. 更新索引檔案
5. 測試網站顯示效果

## 特殊注意事項

### 編碼處理
- 所有 Python 腳本都正確處理 UTF-8 編碼
- Git 配置避免檔名轉義問題
- Windows 系統特別處理控制台編碼

### 字數統計
- `generate_novels.py` 會自動計算每部作品的總字數
- 排除簡介和譯名檔案
- 移除 Markdown 標記後計算

### 自動化功能
- 服務器啟動前自動生成索引
- 自動更新腳本包含智能 commit 訊息生成
- 支援自動處理進程衝突

### 智能檔案過濾
`自動更新.py` 腳本包含智能過濾功能，會自動忽略以下檔案：

#### Claude Code 相關檔案
- `.claude/` 資料夾及其所有內容
- `CLAUDE.md` 檔案

#### 常見系統和臨時檔案
- 臨時檔案: `.tmp`, `.temp`, `~` 結尾
- 系統檔案: `Thumbs.db`, `.DS_Store`
- 編輯器檔案: `.swp`, `.swo`, `.bak`, `.orig`
- 編輯器配置: `.vscode/`, `.idea/`
- 開發環境: `node_modules/`, `__pycache__/`
- 日誌檔案: `.log`, `.pid`

當有檔案被忽略時，腳本會顯示清楚的提示訊息，讓用戶知道哪些檔案被跳過了。

## 網站功能

### 主要頁面
- `index.html`: 主頁，包含作品分類導航
- `acgntranslate.html`: 翻譯作品展示頁面
- `recommendations.html`: 作品推薦頁面
- 遊戲頁面: `destiny-game-class.html`, `shooting-game.html`

### 靜態資源
- `images/`: 圖片資源
- `sounds/`: 音效檔案
- CSS 和 JavaScript 內嵌在 HTML 檔案中

## 故障排除

### 服務器啟動問題
- 自動終止佔用相同埠口的舊進程
- 自動嘗試其他可用埠口
- 檢查 Python 版本（需要 3.6+）

### Git 更新問題
- 自動修復 Git 安全目錄設定
- 處理檔名編碼問題
- 智能生成 commit 訊息
- **推送衝突處理**: `通用自動更新.py` 自動檢測並處理推送衝突
  - 當遠端有新提交時，自動提示解決方案
  - 支援自動拉取遠端變更並重新推送
  - 使用 `--auto-pull` 參數可完全自動化處理

### 索引生成問題
- 檢查檔案命名是否符合規範
- 確認簡介檔案格式正確
- 驗證 cover.jpg 檔案存在