<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="å°„æ“ŠæŒ‘æˆ°æ˜¯ä¸€æ¬¾è€ƒé©—ç²¾æº–åº¦èˆ‡åæ‡‰é€Ÿåº¦çš„ç¶²é å°„æ“ŠéŠæˆ²ã€‚æŒ‘æˆ°ä¸åŒé›£åº¦ç­‰ç´šï¼Œç´¯ç©é€£æ“Šå–å¾—é«˜åˆ†ï¼Œæ”¯æ´å¤šç¨®éŠæˆ²æ¨¡å¼ï¼Œé©åˆæ‰€æœ‰ä¼‘é–’éŠæˆ²æ„›å¥½è€…ã€‚äº«å—æµæš¢çš„å°„æ“Šé«”é©—ï¼ŒæŒ‘æˆ°ä½ çš„æ¥µé™ï¼">
    <meta name="keywords" content="å°„æ“ŠéŠæˆ², å°„æ“ŠæŒ‘æˆ°, ç¶²é éŠæˆ², HTML5éŠæˆ², ç²¾æº–ç„æº–, é€£æ“Šç³»çµ±, è¨ˆæ™‚æŒ‘æˆ°, åæ‡‰è¨“ç·´, åˆ†æ•¸æ’è¡Œ, å¤šç¨®é›£åº¦, ç„æº–è¨“ç·´, ä¼‘é–’éŠæˆ², ç€è¦½å™¨éŠæˆ²">
    <link rel="icon" href="images/favicon.jpg" type="image/jpg">
    <title>å°„æ“ŠæŒ‘æˆ°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation; /* å„ªåŒ–è§¸æ‘¸é«”é©—ï¼Œé¿å…ç¸®æ”¾å’Œé›™æ“Šå•é¡Œ */
            -webkit-user-select: none;  /* å…¨å±€é˜²æ­¢æ–‡å­—é¸å– */
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            background-color: #1a1a2e;
            color: #fff;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹• */
        }
        
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16213e, #0f3460);
            border: none;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        /* é¦–é æ¨£å¼ */
        .home-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16213e, #0f3460);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 40px 20px;
            z-index: 20;
            transition: all 0.5s ease;
        }
        
        .game-title {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .game-title h1 {
            font-size: 52px;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 0 0 15px rgba(80, 140, 255, 0.7);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(80, 140, 255, 0.7); }
            to { text-shadow: 0 0 20px rgba(80, 140, 255, 0.9), 0 0 30px rgba(80, 140, 255, 0.6); }
        }
        
        .subtitle {
            font-size: 22px;
            color: #e2e2e2;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .game-menu {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 280px;
        }
        
        .menu-button {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 100%;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .menu-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #4895ef, #3f37c9);
        }
        
        .menu-button:active {
            transform: translateY(-2px);
        }
        
        .game-info {
            text-align: center;
            margin-top: 30px;
            font-size: 16px;
            background-color: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            width: 280px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .mode-display, .high-score {
            margin: 8px 0;
        }
        
        .high-score span {
            color: #4cc9f0;
            font-weight: bold;
        }
        
        .footer {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin-top: 20px;
        }
        
        /* éŠæˆ²èªªæ˜ç•«é¢ */
        .instructions-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.95);
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px 30px;
            z-index: 15;
            transition: all 0.5s ease;
        }
        
        .instructions-content {
            max-width: 600px;
            margin: 10px 0 20px 0;
            line-height: 1.6;
            max-height: 70vh;
            overflow-y: auto;
            padding: 0 15px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2);
        }
        
        .instructions-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .instructions-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .instructions-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .instructions-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .instructions-content h2 {
            margin: 20px 0 10px;
            color: #4cc9f0;
            font-size: 22px;
        }
        
        .instructions-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions-content li {
            margin-bottom: 8px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        /* é¶å­æ¨£å¼ */
        .target {
            position: absolute;
            width: 100px;
            height: 180px;
            cursor: crosshair;
            display: none;
            transition: transform 0.2s ease;
            touch-action: none; /* ç¦æ­¢ç§»å‹•è¨­å‚™ä¸Šçš„è§¸æ‘¸æ“ä½œ */
        }
        
        .target.circle-target {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, white 10%, #4d96ff 10%, #4d96ff 30%, white 30%, white 50%, #3a84e8 50%, #3a84e8 70%, white 70%);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.7);
        }
        
        .target.circle-target:active {
            transform: scale(0.9);
        }
        
        .head {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #4d96ff;
            border-radius: 50%;
            top: 0;
            left: 30px;
            transition: transform 0.1s;
            border: 2px solid #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .head:active {
            transform: scale(0.9);
        }
        
        .body {
            position: absolute;
            width: 50px;
            height: 80px;
            background-color: #4d96ff;
            top: 40px;
            left: 25px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .arm-left, .arm-right {
            position: absolute;
            width: 15px;
            height: 60px;
            background-color: #4d96ff;
            top: 45px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .arm-left {
            left: 10px;
        }
        
        .arm-right {
            right: 10px;
        }
        
        .leg-left, .leg-right {
            position: absolute;
            width: 15px;
            height: 60px;
            background-color: #4d96ff;
            top: 120px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .leg-left {
            left: 25px;
        }
        
        .leg-right {
            right: 25px;
        }
        
        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            z-index: 5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .time, .score {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .time i, .score i {
            font-size: 20px;
        }
        
        .time span, .score span {
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .start-screen, .end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: all 0.5s ease;
        }
        
        .missed {
            opacity: 0.7;
            filter: grayscale(50%);
        }
        
        strong {
            color: #fff;
            background-color: #4361ee;
            padding: 0 5px;
            border-radius: 3px;
        }
        
        .end-screen {
            display: none;
        }
        
        .score-display {
            font-size: 64px;
            margin: 30px 0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }
        
        .stats {
            background-color: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-width: 300px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .stat-value {
            font-weight: bold;
            color: #4cc9f0;
        }
        
        button {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #4895ef, #3f37c9);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .small-button {
            padding: 8px 12px;
            font-size: 14px;
            margin: 0 5px;
        }
        
        #end-game-button {
            background: linear-gradient(135deg, #ef476f, #d90429);
        }
        
        #end-game-button:hover {
            background: linear-gradient(135deg, #f25a82, #e71735);
        }
        
        .controls {
            display: flex;
            gap: 8px;
        }
        
        h1 {
            font-size: 40px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        /* è¨­ç½®é¢æ¿ */
        .settings-panel {
            position: absolute;
            top: 60px;
            right: -300px;
            width: 280px;
            max-height: 80vh; /* è¨­ç½®æœ€å¤§é«˜åº¦ç‚ºè¦–çª—é«˜åº¦çš„80% */
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.95), rgba(15, 52, 96, 0.95));
            padding: 20px;
            border-radius: 10px;
            z-index: 25;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: right 0.4s ease;
            border: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto; /* æ·»åŠ å‚ç›´æ»¾å‹• */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2); /* Firefox */
        }
        
        /* WebKitç€è¦½å™¨çš„æ»¾å‹•æ¢æ¨£å¼ */
        .settings-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .settings-panel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .settings-panel::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .settings-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .settings-panel.show-settings {
            right: 10px;
        }
        
        /* è¨­å®šæŒ‰éˆ•é‡æ–°è¨­è¨ˆ - æ”¹ç‚ºåªå‡ºç¾åœ¨é¦–é å³ä¸Šè§’ */
        .settings-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, #4896ef, #4361ee);
            color: white;
            border: none;
            border-radius: 10px;
            width: auto;
            height: auto;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .settings-toggle::before {
            content: "âš™ï¸";
            font-size: 18px;
        }
        
        .settings-toggle:hover {
            background: linear-gradient(135deg, #5ba3f0, #536cf5);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.4);
        }
        
        .setting-item {
            margin: 15px 0;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .difficulty-buttons {
            display: flex;
            gap: 8px;
        }
        
        .diff-button {
            flex: 1;
            padding: 8px 5px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .diff-button.active {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        /* ç§»å‹•æ–¹å¼æŒ‰éˆ•æ¨£å¼ */
        .move-type-buttons {
            display: flex;
            gap: 8px;
        }
        
        .move-button {
            flex: 1;
            padding: 8px 5px;
            font-size: 14px;
            background: rgba(128,128,128,0.3); /* ç°è‰²èƒŒæ™¯ */
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.6); /* ç°è‰²æ–‡å­— */
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .move-button.active {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            color: white; /* æ¢å¾©ç™½è‰²æ–‡å­— */
        }
        
        .move-button:hover {
            background: rgba(128,128,128,0.5); /* ç°è‰²èƒŒæ™¯ï¼Œä½†ç•¥å¾®äº®ä¸€äº› */
        }
        
        .move-button.active:hover {
            background: linear-gradient(135deg, #5ba3f0, #4361ee);
            transform: translateY(-2px);
        }
        
        /* è¦–è¦ºç‰¹æ•ˆ */
        .bullet-hole {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, rgba(0,0,0,0.8) 20%, rgba(50,50,50,0.8) 40%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
            pointer-events: none;
            transform: translate(-50%, -50%);
            box-shadow: inset 0 0 2px rgba(0,0,0,0.8);
        }
        
        .hit-flash {
            animation: flash 0.2s ease-out;
        }
        
        @keyframes flash {
            0% { filter: brightness(1); }
            50% { filter: brightness(3); }
            100% { filter: brightness(1); }
        }
        
        .screen-shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake {
            10%, 90% { transform: translate(-1px, -1px); }
            20%, 80% { transform: translate(2px, 2px); }
            30%, 70% { transform: translate(-2px, -2px); }
            40%, 60% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
        }
        
        .screen-shake-light {
            animation: shake-light 0.2s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake-light {
            10%, 90% { transform: translate(-0.5px, -0.5px); }
            20%, 80% { transform: translate(1px, 1px); }
            30%, 70% { transform: translate(-1px, -1px); }
            40%, 60% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
        }
        
        /* å€’æ•¸è¨ˆæ™‚ */
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(67, 97, 238, 0.8);
            z-index: 15;
            transition: all 0.3s ease;
        }
        
        .countdown-pulse {
            animation: pulse 0.9s cubic-bezier(0.5, 0, 0.5, 1);
            transform: translate(-50%, -50%) scale(1);
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* é£„å­—æ•ˆæœ */
        .floating-text {
            position: absolute;
            color: white;
            font-size: 18px;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            animation: float-up 1s ease-out forwards;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 5px rgba(0,0,0,0.7);
        }
        
        .combo-text {
            color: #ffcc00;
            text-shadow: 0 0 5px rgba(255, 204, 0, 0.7);
        }
        
        .bonus-text {
            color: #ff3399;
            text-shadow: 0 0 5px rgba(255, 51, 153, 0.7);
        }
        
        .penalty-text {
            color: #ff3333;
            text-shadow: 0 0 5px rgba(255, 51, 51, 0.7);
            font-weight: bold;
        }
        
        @keyframes float-up {
            0% { transform: translate(-50%, -50%); opacity: 1; }
            100% { transform: translate(-50%, -100px); opacity: 0; }
        }
        
        /* æ™‚é–“è­¦å‘Š */
        .time-warning {
            animation: pulse-warning 1s infinite;
            color: #ff3333 !important;
        }
        
        @keyframes pulse-warning {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* æ–°ç´€éŒ„å‹•ç•« */
        .new-record {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f72585, #7209b7);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            animation: bounce 2s infinite;
            box-shadow: 0 0 20px rgba(247, 37, 133, 0.7);
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-20px); }
            60% { transform: translateX(-50%) translateY(-10px); }
        }
        
        /* æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* æ»‘å…¥æ•ˆæœ */
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }
        
        /* å½ˆè—¥å’Œé€£æ“Šé¡¯ç¤º */
        .combo-display {
            position: absolute;
            right: 15px;
            bottom: 15px;
            background: rgba(0,0,0,0.6);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .combo-count {
            font-weight: bold;
            color: #ffcc00;
        }
        
        /* è¨­å®šæ¸¸æ¨™ç‚ºç„æº–æ¨£å¼ */
        .game-container {
            cursor: crosshair;
        }
        
        /* æ­·å²ç´€éŒ„æŒ‰éˆ• */
        .history-toggle {
            position: absolute;
            top: 25px;
            right: 130px; /* æ”¾åœ¨è¨­å®šæŒ‰éˆ•å·¦å´ */
            background: linear-gradient(135deg, #f72585, #b5179e);
            color: white;
            border: none;
            border-radius: 10px;
            width: auto;
            height: auto;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .history-toggle::before {
            content: "ğŸ“–";
            font-size: 18px;
        }
        
        .history-toggle:hover {
            background: linear-gradient(135deg, #f94498, #c429b2);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.4);
        }
        
        /* æ­·å²ç´€éŒ„é¢æ¿ */
        .history-panel {
            position: fixed;
            top: 60px;
            right: -350px;
            width: 350px;
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.95), rgba(15, 52, 96, 0.95));
            padding: 20px;
            border-radius: 10px;
            z-index: 25;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: right 0.4s ease;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2); /* Firefox */
        }
        
        /* WebKitç€è¦½å™¨çš„æ»¾å‹•æ¢æ¨£å¼ */
        .history-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-panel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .history-panel::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .history-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .history-panel h2 {
            color: #f72585;
            margin-bottom: 15px;
            text-align: center;
            font-size: 22px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }
        
        .history-panel.show-history {
            right: 10px;
        }
        
        .history-records {
            max-height: calc(80vh - 100px);
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .history-records::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-records::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .history-records::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        
        .history-records::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .record-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        
        .record-item:last-child {
            margin-bottom: 0;
        }
        
        .record-info {
            flex: 1;
        }
        
        .record-date {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .record-mode {
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .record-score {
            font-weight: bold;
            color: #f72585;
            font-size: 18px;
        }
        
        .record-accuracy {
            font-size: 14px;
            color: #4cc9f0;
        }
        
        /* æ–°å¢æ’è¡Œæ¦œæ¨£å¼ */
        .record-rank {
            background-color: #f72585;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .top-rank {
            background: linear-gradient(135deg, #f72585, #7209b7);
            box-shadow: 0 0 10px rgba(247, 37, 133, 0.5);
        }
        
        .no-records {
            text-align: center;
            color: rgba(255,255,255,0.5);
            padding: 20px 0;
            font-style: italic;
        }
        
        #close-history {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background: linear-gradient(135deg, #f72585, #b5179e);
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        #close-history:hover {
            background: linear-gradient(135deg, #f94498, #c429b2);
            transform: translateY(-2px);
        }
        
        /* æ­·å²ç´€éŒ„å€åŸŸæ¨£å¼ */
        .history-section {
            width: 80%;
            max-width: 600px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .history-section h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
            text-align: center;
            font-size: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .history-records {
            max-height: 180px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .history-records::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-records::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .history-records::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        
        .history-records::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        
        .record-item:last-child {
            border-bottom: none;
        }
        
        .record-date, .record-mode {
            flex: 1;
        }
        
        .record-score {
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .no-records {
            text-align: center;
            color: rgba(255,255,255,0.5);
            padding: 20px 0;
            font-style: italic;
        }
        
        /* ç¦æ­¢æ‰€æœ‰å…ƒç´ çš„æ–‡å­—é¸å– */
        html, body, div, span, h1, h2, h3, p, a, button, input, label,
        .game-container, .target, .head, .body, .home-screen, .start-screen,
        .end-screen, .instructions-screen, .info-panel, .settings-panel,
        .history-panel, .game-title, .subtitle, .game-menu, .game-info,
        .footer, .settings-toggle, .history-toggle, .menu-button, .combo-display,
        .record-item, .floating-text, .countdown {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* é¡è‰²é¸æ“‡å™¨æ¨£å¼ */
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.8);
        }
        
        .color-option.active {
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        /* è‡ªå®šç¾©é¡è‰²è¼¸å…¥ */
        .color-custom {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .color-input {
            width: 60px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 0;
            background: none;
        }
        
        .color-input::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .color-input::-webkit-color-swatch {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
        }
        
        .color-apply {
            padding: 5px 10px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .color-apply:hover {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            transform: translateY(-2px);
        }
        
        /* æš«åœç•«é¢ */
        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 20;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .pause-overlay h2 {
            font-size: 48px;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 0 15px rgba(76, 201, 240, 0.8);
        }
        
        .pause-controls {
            display: flex;
            gap: 20px;
        }
        
        #resume-button {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }
        
        #resume-button:hover {
            background: linear-gradient(135deg, #49d5ff, #536dff);
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.8);
        }
        
        .color-option.active {
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media screen and (max-width: 768px) {
            .game-title h1 {
                font-size: 40px;
            }
            
            .subtitle {
                font-size: 18px;
            }
            
            .game-menu {
                width: 80%;
                max-width: 300px;
            }
            
            .game-info {
                width: 80%;
                max-width: 300px;
            }
            
            .settings-panel {
                width: 90%;
                max-width: 300px;
            }
        }
        
        /* ç¢ºä¿æœ€å°é«˜åº¦ */
        @media screen and (max-height: 600px) {
            .game-menu {
                gap: 8px;
            }
            
            .game-title {
                margin-bottom: 10px;
            }
            
            .menu-button {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container" id="game-container">
        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel">
            <div class="time"><i class="fas fa-clock"></i>æ™‚é–“: <span id="time-left">60</span></div>
            <div class="controls">
                <button id="pause-game-button" class="small-button">æš«åœ</button>
                <button id="end-game-button" class="small-button">çµæŸéŠæˆ²</button>
            </div>
            <div class="score"><i class="fas fa-star"></i>åˆ†æ•¸: <span id="score">0</span></div>
        </div>
        
        <!-- é€£æ“Šé¡¯ç¤º -->
        <div class="combo-display" id="combo-display" style="display: none;">
            é€£æ“Š: <span id="combo-count" class="combo-count">0</span>
        </div>
        
        <!-- äººå½¢é¶å­ -->
        <div class="target" id="target">
            <div class="head" id="head"></div>
            <div class="body"></div>
            <div class="arm-left"></div>
            <div class="arm-right"></div>
            <div class="leg-left"></div>
            <div class="leg-right"></div>
        </div>
        
        <!-- é¦–é  -->
        <div class="home-screen" id="home-screen">
            <!-- è¨­ç½®æŒ‰éˆ• - ç¾åœ¨æ”¾ç½®åœ¨é¦–é å…§ -->
            <button id="settings-button" class="settings-toggle">è¨­å®š</button>
            
            <!-- æ­·å²è¨˜éŒ„æŒ‰éˆ• -->
            <button id="history-button" class="history-toggle">æ­·å²ç´€éŒ„</button>
            
            <div class="game-title">
                <h1>å°„æ“ŠæŒ‘æˆ°</h1>
                <div class="subtitle">ç²¾æº–ç„æº–ï¼Œå¿«é€Ÿåæ‡‰</div>
            </div>
            
            <div class="game-menu">
                <button id="play-button" class="menu-button">é–‹å§‹éŠæˆ²</button>
                <button id="home-toggle-mode" class="menu-button">åˆ‡æ›æ¨¡å¼</button>
                <button id="instructions-button" class="menu-button">éŠæˆ²èªªæ˜</button>
            </div>
            
            <div class="game-info">
                <div class="mode-display">
                    ç•¶å‰æ¨¡å¼: <span id="current-mode">äººå½¢é¶å­</span>
                </div>
                <div class="move-display">
                    ç§»å‹•æ–¹å¼: <span id="current-move-type">æ¼¸è®Šç§»å‹•</span>
                </div>
                <div class="high-score">
                    æœ€é«˜åˆ†æ•¸: <span id="high-score">0</span>
                </div>
            </div>
            
            <div class="footer">
                å°„æ“ŠæŒ‘æˆ°éŠæˆ² &copy; 2025
            </div>
        </div>
        
        <!-- é–‹å§‹ç•«é¢ -->
        <div class="start-screen" id="start-screen">
            <h1>å°„æ“ŠæŒ‘æˆ°éŠæˆ²</h1>
            <p>å°„æ“Šäººå½¢é¶å­çš„<strong>é ­éƒ¨</strong>ç²å¾—åˆ†æ•¸ï¼Œ<strong>æ²’å°„ä¸­æœƒæ‰£1åˆ†</strong>ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼</p>
            <div class="button-group">
                <button id="start-button">é–‹å§‹éŠæˆ²</button>
                <button id="back-to-home">è¿”å›é¦–é </button>
            </div>
        </div>
        
        <!-- éŠæˆ²èªªæ˜ç•«é¢ -->
        <div class="instructions-screen" id="instructions-screen">
            <h1>éŠæˆ²èªªæ˜</h1>
            <div class="instructions-content">
                <h2>éŠæˆ²æ¨¡å¼</h2>
                <p><strong>äººå½¢æ¨¡å¼ï¼š</strong>å°„æ“Šäººå½¢é¶å­çš„é ­éƒ¨æ‰èƒ½å¾—åˆ†ï¼Œå…¶ä»–éƒ¨ä½é»æ“Šç„¡æ•ˆã€‚</p>
                <p><strong>é¶å¿ƒæ¨¡å¼ï¼š</strong>å°„æ“Šåœ“å½¢é¶å¿ƒçš„ä»»ä½•éƒ¨ä½éƒ½å¯å¾—åˆ†ã€‚</p>
                
                <h2>éŠæˆ²è¦å‰‡</h2>
                <ul>
                    <li>éŠæˆ²æ™‚é–“ç‚º60ç§’</li>
                    <li>å°„æ“Šæœ‰æ•ˆç›®æ¨™å¾Œï¼Œç›®æ¨™æœƒéš¨æ©Ÿç§»å‹•ä½ç½®</li>
                    <li>æ¯æ¬¡å°„æ“ŠæˆåŠŸå¾—1åˆ†</li>
                    <li>æ²’å°„åˆ°é¶å­æœƒæ‰£1åˆ†</li>
                    <li>é€£çºŒå‘½ä¸­å¯ç²å¾—é€£æ“ŠåŠ æˆ</li>
                    <li>æ¯10é€£æ“Šå¯ç²å¾—é¡å¤–çå‹µåˆ†æ•¸1åˆ†</li>
                    <li>å¯ä»¥éš¨æ™‚çµæŸéŠæˆ²æˆ–æš«åœéŠæˆ²</li>
                </ul>
                
                <h2>é›£åº¦è¨­å®š</h2>
                <ul>
                    <li><strong>ç°¡å–®ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦æ…¢ï¼Œå°ºå¯¸è¼ƒå¤§</li>
                    <li><strong>ä¸­ç­‰ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦ä¸­ç­‰ï¼Œæ¨™æº–å°ºå¯¸</li>
                    <li><strong>å›°é›£ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦å¿«ï¼Œå°ºå¯¸è¼ƒå°</li>
                </ul>
                
                <h2>éŠæˆ²è¨­å®š</h2>
                <ul>
                    <li><strong>é¶å­ç§»å‹•æ–¹å¼ï¼š</strong>å¯é¸æ“‡æ¼¸è®Šç§»å‹•æˆ–ç¬é–“ç§»å‹•</li>
                    <li><strong>é¡è‰²è¨­å®šï¼š</strong>å¯è‡ªå®šç¾©èƒŒæ™¯å’Œæ¨™é¶é¡è‰²</li>
                    <li><strong>éŸ³æ•ˆè¨­å®šï¼š</strong>å¯èª¿æ•´éŸ³é‡æˆ–è¨­ç‚ºéœéŸ³</li>
                </ul>
                
                <h2>å…¶ä»–åŠŸèƒ½</h2>
                <ul>
                    <li><strong>æš«åœåŠŸèƒ½ï¼š</strong>éŠæˆ²ä¸­å¯éš¨æ™‚æš«åœ</li>
                    <li><strong>æ­·å²ç´€éŒ„ï¼š</strong>ä¿å­˜éŠæˆ²åˆ†æ•¸ã€é€£æ“Šå’Œå‘½ä¸­ç‡ç­‰æ•¸æ“š</li>
                    <li><strong>æœ€é«˜åˆ†æ•¸ï¼š</strong>è‡ªå‹•è¨˜éŒ„æœ€é«˜åˆ†</li>
                </ul>
            </div>
            <button id="back-from-instructions">è¿”å›é¦–é </button>
        </div>
        
        <!-- çµæŸç•«é¢ -->
        <div class="end-screen" id="end-screen">
            <h1>éŠæˆ²çµæŸï¼</h1>
            <div class="score-display">ä½ çš„åˆ†æ•¸: <span id="final-score">0</span></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-name">æœ€é«˜é€£æ“Š:</div>
                    <div class="stat-value" id="max-combo">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">å‘½ä¸­ç‡:</div>
                    <div class="stat-value" id="accuracy">0%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">å‘½ä¸­æ¬¡æ•¸:</div>
                    <div class="stat-value" id="shots-hit">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">æœªå‘½ä¸­æ¬¡æ•¸:</div>
                    <div class="stat-value" id="shots-missed">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">çå‹µåˆ†æ•¸:</div>
                    <div class="stat-value" id="bonus-points">0</div>
                </div>
            </div>
            <div class="button-group">
                <button id="restart-button">å†ç©ä¸€æ¬¡</button>
                <button id="home-button">è¿”å›é¦–é </button>
            </div>
        </div>
        
        <!-- è¨­ç½®é¢æ¿ -->
        <div class="settings-panel" id="settings-panel">
            <h2>éŠæˆ²è¨­å®š</h2>
            <div class="setting-item">
                <label for="volume-control">éŸ³é‡</label>
                <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.7">
            </div>
            <div class="setting-item">
                <label for="mute-toggle">éœéŸ³</label>
                <input type="checkbox" id="mute-toggle">
            </div>
            <div class="setting-item">
                <label>é›£åº¦</label>
                <div class="difficulty-buttons">
                    <button id="easy-button" class="diff-button">ç°¡å–®</button>
                    <button id="medium-button" class="diff-button active">ä¸­ç­‰</button>
                    <button id="hard-button" class="diff-button">å›°é›£</button>
                </div>
            </div>
            <div class="setting-item">
                <label>é¶å­ç§»å‹•æ–¹å¼</label>
                <div class="move-type-buttons">
                    <button id="transition-move" class="move-button active">æ¼¸è®Šç§»å‹•</button>
                    <button id="instant-move" class="move-button">ç¬é–“ç§»å‹•</button>
                </div>
            </div>
            <div class="setting-item">
                <label>èƒŒæ™¯é¡è‰²</label>
                <div class="color-options" id="bg-color-options">
                    <div class="color-option" data-color="#16213e" style="background-color: #16213e;"></div>
                    <div class="color-option" data-color="#1a1a2e" style="background-color: #1a1a2e;"></div>
                    <div class="color-option" data-color="#3a0ca3" style="background-color: #3a0ca3;"></div>
                    <div class="color-option" data-color="#3d405b" style="background-color: #3d405b;"></div>
                    <div class="color-option" data-color="#3d0066" style="background-color: #3d0066;"></div>
                    <div class="color-option" data-color="#242423" style="background-color: #242423;"></div>
                    <div class="color-option" data-color="#1b4332" style="background-color: #1b4332;"></div>
                    <div class="color-option" data-color="#582f0e" style="background-color: #582f0e;"></div>
                    <div class="color-option" data-color="#023047" style="background-color: #023047;"></div>
                    <div class="color-option" data-color="#370617" style="background-color: #370617;"></div>
                    <div class="color-option" data-color="#000814" style="background-color: #000814;"></div>
                    <div class="color-option" data-color="#540b0e" style="background-color: #540b0e;"></div>
                </div>
                <div class="color-custom">
                    <input type="color" id="bg-color-custom" class="color-input" value="#16213e">
                    <button id="bg-color-apply" class="color-apply">å¥—ç”¨</button>
                </div>
            </div>
            <div class="setting-item">
                <label>æ¨™é¶é¡è‰²</label>
                <div class="color-options" id="target-color-options">
                    <div class="color-option" data-color="#4d96ff" style="background-color: #4d96ff;"></div>
                    <div class="color-option" data-color="#f72585" style="background-color: #f72585;"></div>
                    <div class="color-option" data-color="#4cc9f0" style="background-color: #4cc9f0;"></div>
                    <div class="color-option" data-color="#f77f00" style="background-color: #f77f00;"></div>
                    <div class="color-option" data-color="#2ec4b6" style="background-color: #2ec4b6;"></div>
                    <div class="color-option" data-color="#fb5607" style="background-color: #fb5607;"></div>
                    <div class="color-option" data-color="#70e000" style="background-color: #70e000;"></div>
                    <div class="color-option" data-color="#ff9f1c" style="background-color: #ff9f1c;"></div>
                    <div class="color-option" data-color="#e63946" style="background-color: #e63946;"></div>
                    <div class="color-option" data-color="#588157" style="background-color: #588157;"></div>
                    <div class="color-option" data-color="#06d6a0" style="background-color: #06d6a0;"></div>
                    <div class="color-option" data-color="#ff85a1" style="background-color: #ff85a1;"></div>
                </div>
                <div class="color-custom">
                    <input type="color" id="target-color-custom" class="color-input" value="#4d96ff">
                    <button id="target-color-apply" class="color-apply">å¥—ç”¨</button>
                </div>
            </div>
            <button id="close-settings">é—œé–‰</button>
        </div>
        
        <!-- æ­·å²ç´€éŒ„é¢æ¿ -->
        <div class="history-panel" id="history-panel">
            <h2>éŠæˆ²æ­·å²ç´€éŒ„</h2>
            <div class="history-records" id="history-records">
                <!-- è¨˜éŒ„é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹æ·»åŠ  -->
                <div class="no-records">å°šç„¡éŠæˆ²ç´€éŒ„</div>
            </div>
            <button id="close-history">é—œé–‰</button>
        </div>
        
        <!-- æš«åœè¦†è“‹å±¤ -->
        <div class="pause-overlay" id="pause-overlay">
            <h2>éŠæˆ²æš«åœ</h2>
            <div class="pause-controls">
                <button id="resume-button">ç¹¼çºŒéŠæˆ²</button>
                <button id="pause-end-game">çµæŸéŠæˆ²</button>
            </div>
        </div>
        
        <!-- è¨­ç½®æŒ‰éˆ• - ç§»åˆ°é¦–é å…§éƒ¨ -->
        <!--<button id="settings-button" class="settings-toggle">è¨­å®š</button>-->
        
        <!-- éŸ³æ•ˆå…ƒç´  -->
        <audio id="sound-shot" src="sounds/shot.mp3" preload="auto"></audio>
        <audio id="sound-hit" src="sounds/hit.mp3" preload="auto"></audio>
        <audio id="sound-miss" src="sounds/miss.mp3" preload="auto"></audio>
        <audio id="sound-game-start" src="sounds/game-start.mp3" preload="auto"></audio>
        <audio id="sound-game-end" src="sounds/game-end.mp3" preload="auto"></audio>
        <audio id="sound-bgm" src="sounds/background-music.mp3" preload="auto" loop></audio>
        
    </div>
    
    <script>
        // ç²å–å…ƒç´ 
        const homeScreen = document.getElementById('home-screen');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const instructionsScreen = document.getElementById('instructions-screen');
        const timeLeftDisplay = document.getElementById('time-left');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('final-score');
        const currentModeDisplay = document.getElementById('current-mode');
        const highScoreDisplay = document.getElementById('high-score');
        const startButton = document.getElementById('start-button');
        const playButton = document.getElementById('play-button');
        const restartButton = document.getElementById('restart-button');
        const homeButton = document.getElementById('home-button');
        const backToHomeButton = document.getElementById('back-to-home');
        const instructionsButton = document.getElementById('instructions-button');
        const backFromInstructionsButton = document.getElementById('back-from-instructions');
        const homeToggleModeButton = document.getElementById('home-toggle-mode');
        const gameContainer = document.getElementById('game-container');
        const comboDisplay = document.getElementById('combo-display');
        const comboCountDisplay = document.getElementById('combo-count');
        const maxComboDisplay = document.getElementById('max-combo');
        const accuracyDisplay = document.getElementById('accuracy');
        const bonusPointsDisplay = document.getElementById('bonus-points');
        const crosshair = document.getElementById('crosshair');
        
        // ä½¿ç”¨å‡½æ•¸ä¾†ç²å–é¶å­å…ƒç´ ï¼Œè€Œä¸æ˜¯å˜—è©¦é‡æ–°è³¦å€¼çµ¦å¸¸é‡
        function getTarget() {
            return document.getElementById('target');
        }
        
        // éŸ³æ•ˆç³»çµ±
        const sounds = {};
        
        // éŠæˆ²è®Šæ•¸
        let score = 0;
        let timeLeft = 60;
        let gameInterval;
        let isPlaying = false;
        let isPaused = false; // æ–°å¢æš«åœç‹€æ…‹è®Šæ•¸
        let gameMode = "human"; // é è¨­ç‚ºäººå½¢æ¨¡å¼ï¼Œå¦ä¸€å€‹é¸é …æ˜¯"target"
        let highScore = 0; // è¨˜éŒ„æœ€é«˜åˆ†
        let combo = 0; // é€£æ“Š
        let maxCombo = 0; // æœ€é«˜é€£æ“Š
        let shotsFired = 0; // å°„æ“Šç¸½æ•¸
        let shotsHit = 0; // å‘½ä¸­æ•¸
        let bonusPoints = 0; // çå‹µåˆ†æ•¸
        let lastHitTime = 0; // ä¸Šæ¬¡å‘½ä¸­æ™‚é–“
        let moveType = "transition"; // é¶å­ç§»å‹•æ–¹å¼ï¼štransition(æ¼¸è®Š) æˆ– instant(ç¬é–“)
        let gameHistory = []; // éŠæˆ²æ­·å²ç´€éŒ„
        
        // é¡è‰²è¨­å®š
        let bgColor = "#16213e"; // é»˜èªèƒŒæ™¯é¡è‰²
        let targetColor = "#4d96ff"; // é»˜èªæ¨™é¶é¡è‰²
        
        // é›£åº¦ç³»çµ±
        const difficulties = {
            easy: { targetSpeed: 1000, targetSize: 1.2 },
            medium: { targetSpeed: 700, targetSize: 1.0 },
            hard: { targetSpeed: 400, targetSize: 0.8 }
        };
        
        let currentDifficulty = 'medium'; // é è¨­é›£åº¦
        
        // éŸ³æ•ˆè¨­ç½®
        const soundSettings = {
            volume: 0.7,
            muted: false
        };
        
        // åˆå§‹åŒ–éŸ³æ•ˆ
        function initSounds() {
            try {
                // è¨˜éŒ„åˆå§‹åŒ–é–‹å§‹
                console.log('é–‹å§‹åˆå§‹åŒ–éŸ³æ•ˆ...');
                
                // ç²å–æ‰€æœ‰éŸ³é »å…ƒç´ 
            sounds.shot = document.getElementById('sound-shot');
            sounds.hit = document.getElementById('sound-hit');
            sounds.miss = document.getElementById('sound-miss');
            sounds.gameStart = document.getElementById('sound-game-start');
            sounds.gameEnd = document.getElementById('sound-game-end');
            sounds.bgm = document.getElementById('sound-bgm');
                
                // æª¢æŸ¥æ¯å€‹éŸ³æ•ˆå…ƒç´ 
                Object.entries(sounds).forEach(([key, sound]) => {
                    if (!sound) {
                        console.error(`æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´  ${key}`);
                    } else {
                        console.log(`éŸ³æ•ˆ ${key} åˆå§‹åŒ–æˆåŠŸ, è·¯å¾‘: ${sound.src}`);
                        
                        // ä¸»å‹•åŠ è¼‰éŸ³æ•ˆ
                        sound.load();
            
            // è¨­ç½®åˆå§‹éŸ³é‡
                sound.volume = soundSettings.volume;
                        
                        // æ·»åŠ éŒ¯èª¤è™•ç†
                        sound.onerror = function(e) {
                            console.error(`éŸ³æ•ˆ ${key} åŠ è¼‰å¤±æ•—:`, e);
                            console.error(`å˜—è©¦è¼‰å…¥çš„è·¯å¾‘: ${sound.src}`);
                        };
                        
                        // æ·»åŠ åŠ è¼‰æˆåŠŸè™•ç†
                        sound.onloadeddata = function() {
                            console.log(`éŸ³æ•ˆ ${key} åŠ è¼‰æˆåŠŸ`);
                        };
                    }
                });
                
                // å˜—è©¦æ’­æ”¾ä¸€å€‹éœéŸ³çš„éŸ³é »ä¾†æ¿€æ´»éŸ³é »ç³»çµ±
                try {
                    const silentSound = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urqIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIgAP/7UMQAABTBMi8PQZC8DpJ3h+DghVYGnP3N1dfWAAMDAyMECBAgAAGBgZGBAgQIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxCmAEhGNJ+gigGG2jab7IGaAAAAACQQghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjg");
                    silentSound.volume = 0;
                    silentSound.play().catch(e => {
                        console.warn('ç„¡æ³•æ’­æ”¾éœéŸ³éŸ³é »:', e);
                    });
                } catch (e) {
                    console.warn('å˜—è©¦æ’­æ”¾éœéŸ³éŸ³é »æ™‚å‡ºéŒ¯:', e);
                }
                
                console.log('éŸ³æ•ˆåˆå§‹åŒ–å®Œæˆ');
            } catch (e) {
                console.error('åˆå§‹åŒ–éŸ³æ•ˆæ™‚ç™¼ç”ŸéŒ¯èª¤:', e);
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(soundName) {
            // å…ˆæª¢æŸ¥è²éŸ³æ˜¯å¦è¢«éœéŸ³
            if (soundSettings.muted) {
                console.log(`éŸ³æ•ˆ ${soundName} è¢«éœéŸ³`);
                return;
            }
            
            // æª¢æŸ¥è²éŸ³å°è±¡æ˜¯å¦å­˜åœ¨
            if (!sounds[soundName]) {
                console.error(`éŸ³æ•ˆ ${soundName} ä¸å­˜åœ¨`);
                
                // å˜—è©¦é‡æ–°ç²å–éŸ³é »å…ƒç´ 
                const audioElement = document.getElementById(`sound-${soundName}`);
                if (audioElement) {
                    console.log(`å˜—è©¦é‡æ–°ç²å–éŸ³æ•ˆå…ƒç´  ${soundName}`);
                    sounds[soundName] = audioElement;
                } else {
                    console.error(`æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´  sound-${soundName}`);
                    return;
                }
            }
            
            // ç¢ºä¿éŸ³é »å…ƒç´ å·²æº–å‚™å¥½
            if (sounds[soundName].readyState === 0) {
                console.warn(`éŸ³æ•ˆ ${soundName} å°šæœªåŠ è¼‰å®Œæˆï¼Œå˜—è©¦é‡æ–°è¼‰å…¥`);
                sounds[soundName].load();
            }
            
            // å˜—è©¦æ’­æ”¾ï¼Œä¸¦æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è™•ç†
            try {
            sounds[soundName].currentTime = 0;
            sounds[soundName].volume = soundSettings.volume;
                
                // ä½¿ç”¨ Promise API æ’­æ”¾éŸ³é »
                const playPromise = sounds[soundName].play();
                
                // ç¾ä»£ç€è¦½å™¨è¿”å› Promise
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log(`éŸ³æ•ˆ ${soundName} æ’­æ”¾æˆåŠŸ`);
                        })
                        .catch(e => {
                            console.error(`æ’­æ”¾éŸ³æ•ˆ ${soundName} å¤±æ•—:`, e);
                            
                            // å¦‚æœæ˜¯ç”±æ–¼ç”¨æˆ¶äº¤äº’é™åˆ¶ï¼Œå¯ä»¥å˜—è©¦åœ¨ä¸‹ä¸€æ¬¡ç”¨æˆ¶äº¤äº’æ™‚æ’­æ”¾
                            if (e.name === 'NotAllowedError') {
                                console.warn('æ’­æ”¾éŸ³æ•ˆéœ€è¦ç”¨æˆ¶äº¤äº’ï¼Œå°‡åœ¨ä¸‹ä¸€æ¬¡ç”¨æˆ¶äº¤äº’æ™‚å˜—è©¦æ’­æ”¾');
                                
                                // åœ¨ä¸‹ä¸€æ¬¡é»æ“Šæ™‚å˜—è©¦å†æ¬¡æ’­æ”¾
                                const playOnClick = () => {
                                    sounds[soundName].play()
                                        .then(() => {
                                            document.removeEventListener('click', playOnClick);
                                        })
                                        .catch(innerError => {
                                            console.error('å†æ¬¡å˜—è©¦æ’­æ”¾å¤±æ•—:', innerError);
                                        });
                                };
                                document.addEventListener('click', playOnClick);
                            }
                        });
                }
            } catch (e) {
                console.error(`å˜—è©¦æ’­æ”¾éŸ³æ•ˆ ${soundName} æ™‚ç™¼ç”ŸéŒ¯èª¤:`, e);
            }
        }
        
        // éŸ³æ•ˆæ¸¬è©¦å‡½æ•¸
        function testSound(soundName) {
            const resultElement = document.getElementById('sound-test-result');
            resultElement.innerHTML = `å˜—è©¦æ’­æ”¾ ${soundName} éŸ³æ•ˆ...`;
            
            try {
                const audioElement = document.getElementById(`sound-${soundName}`);
                if (!audioElement) {
                    resultElement.innerHTML += '<br>æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´ ï¼è«‹æª¢æŸ¥HTMLä¸­çš„audioæ¨™ç±¤ã€‚';
                    return;
                }
                
                resultElement.innerHTML += `<br>éŸ³æ•ˆå…ƒç´ æ‰¾åˆ°: ${audioElement.id}`;
                resultElement.innerHTML += `<br>éŸ³æ•ˆæª”æ¡ˆè·¯å¾‘: ${audioElement.src}`;
                
                // æª¢æŸ¥æª”æ¡ˆæ˜¯å¦èƒ½è¼‰å…¥
                const tempAudio = new Audio();
                tempAudio.onloadeddata = function() {
                    resultElement.innerHTML += '<br>éŸ³æ•ˆæª”æ¡ˆè¼‰å…¥æˆåŠŸï¼';
                    resultElement.innerHTML += '<br>å˜—è©¦æ’­æ”¾...';
                    
                    // å˜—è©¦æ’­æ”¾
                    tempAudio.play()
                        .then(() => {
                            resultElement.innerHTML += '<br><span style="color: #4cc9f0;">æ’­æ”¾æˆåŠŸï¼</span>';
                        })
                        .catch(e => {
                            resultElement.innerHTML += `<br><span style="color: #f72585;">æ’­æ”¾å¤±æ•—: ${e.message}</span>`;
                            resultElement.innerHTML += '<br>å¯èƒ½åŸå› : ç€è¦½å™¨é˜»æ­¢è‡ªå‹•æ’­æ”¾ã€æª”æ¡ˆæå£æˆ–æ ¼å¼ä¸æ”¯æ´';
                        });
                };
                
                tempAudio.onerror = function() {
                    resultElement.innerHTML += `<br><span style="color: #f72585;">éŸ³æ•ˆæª”æ¡ˆè¼‰å…¥å¤±æ•—ï¼</span>`;
                    resultElement.innerHTML += '<br>å¯èƒ½åŸå› : æª”æ¡ˆè·¯å¾‘éŒ¯èª¤ã€æª”æ¡ˆä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ”¯æ´';
                    resultElement.innerHTML += `<br>è«‹æª¢æŸ¥ ${audioElement.src} æ˜¯å¦å­˜åœ¨ä¸”å¯è¨ªå•`;
                };
                
                tempAudio.src = audioElement.src;
            } catch (e) {
                resultElement.innerHTML += `<br><span style="color: #f72585;">éŒ¯èª¤: ${e.message}</span>`;
            }
        }
        
        // éŸ³æ•ˆæ¸¬è©¦é¢æ¿åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const openButton = document.getElementById('open-sound-test');
            const closeButton = document.getElementById('close-sound-test');
            const testShotButton = document.getElementById('test-shot-sound');
            const testHitButton = document.getElementById('test-hit-sound');
            const testMissButton = document.getElementById('test-miss-sound');
            const testPanel = document.getElementById('sound-test-panel');
            
            if (openButton) {
                openButton.addEventListener('click', function() {
                    testPanel.style.display = 'block';
                });
            }
            
            if (closeButton) {
                closeButton.addEventListener('click', function() {
                    testPanel.style.display = 'none';
                });
            }
            
            if (testShotButton) {
                testShotButton.addEventListener('click', function() {
                    testSound('shot');
                });
            }
            
            if (testHitButton) {
                testHitButton.addEventListener('click', function() {
                    testSound('hit');
                });
            }
            
            if (testMissButton) {
                testMissButton.addEventListener('click', function() {
                    testSound('miss');
                });
            }
        });
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            score = 0;
            timeLeft = 60;
            combo = 0;
            maxCombo = 0;
            shotsFired = 0;
            shotsHit = 0;
            bonusPoints = 0;
            
            scoreDisplay.textContent = score;
            timeLeftDisplay.textContent = timeLeft;
            comboCountDisplay.textContent = combo;
            comboDisplay.style.display = 'none';
            
            getTarget().style.display = 'none';
            isPlaying = false;
            clearInterval(gameInterval);
            
            // æ›´æ–°æœ€é«˜åˆ†é¡¯ç¤º
            highScoreDisplay.textContent = highScore;
            
            // æ ¹æ“šéŠæˆ²æ¨¡å¼è¨­ç½®é¶å­
            setupTargetByMode();
            
            // æ›´æ–°ç•¶å‰æ¨¡å¼é¡¯ç¤º
            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
            
            // æ›´æ–°ç§»å‹•æ–¹å¼é¡¯ç¤º
            document.getElementById('current-move-type').textContent = moveType === 'transition' ? 'æ¼¸è®Šç§»å‹•' : 'ç¬é–“ç§»å‹•';
            
            // ç§»é™¤æ‰€æœ‰å½ˆå­”å’Œç‰¹æ•ˆ
            document.querySelectorAll('.bullet-hole, .particle, .floating-text').forEach(el => {
                el.remove();
            });
            
            // é‡ç½®æ™‚é–“è­¦å‘Šæ¨£å¼
            timeLeftDisplay.classList.remove('time-warning');
            
            // ç¢ºä¿æ¸¸æ¨™ç‚ºç„æº–æ¨£å¼
            gameContainer.style.cursor = 'crosshair';
            
            // æ‡‰ç”¨é¡è‰²è¨­å®š
            setBgColor(bgColor);
            setTargetColor(targetColor);
        }
        
        // é¡¯ç¤ºé¦–é 
        function showHome() {
            homeScreen.style.display = 'flex';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            getTarget().style.display = 'none';
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            homeScreen.classList.add('fade-in');
            
            isPlaying = false;
            clearInterval(gameInterval);
            
            // åœæ­¢èƒŒæ™¯éŸ³æ¨‚
            if (sounds.bgm) {
                sounds.bgm.pause();
                sounds.bgm.currentTime = 0;
            }
            
            // æ›´æ–°é«˜åˆ†å’Œç•¶å‰æ¨¡å¼é¡¯ç¤º
            highScoreDisplay.textContent = highScore;
            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
        }
        
        // é¡¯ç¤ºé–‹å§‹ç•«é¢
        function showStartScreen() {
            homeScreen.style.display = 'none';
            startScreen.style.display = 'flex';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            getTarget().style.display = 'none';
            
            // é—œé–‰è¨­å®šé¢æ¿å’Œæ­·å²è¨˜éŒ„é¢æ¿
            document.getElementById('settings-panel').classList.remove('show-settings');
            document.getElementById('history-panel').classList.remove('show-history');
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            startScreen.classList.add('slide-in');
        }
        
        // é¡¯ç¤ºèªªæ˜ç•«é¢
        function showInstructions() {
            homeScreen.style.display = 'none';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'flex';
            getTarget().style.display = 'none';
            
            // é—œé–‰è¨­å®šé¢æ¿å’Œæ­·å²è¨˜éŒ„é¢æ¿
            document.getElementById('settings-panel').classList.remove('show-settings');
            document.getElementById('history-panel').classList.remove('show-history');
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            instructionsScreen.classList.add('fade-in');
        }
        
        // æ ¹æ“šç•¶å‰æ¨¡å¼è¨­ç½®é¶å­
        function setupTargetByMode() {
            // ç²å–ç›®æ¨™å®¹å™¨
            const targetElement = getTarget();
            
            // æ¸…ç©ºç›®æ¨™å®¹å™¨
            targetElement.innerHTML = '';
            
            if (gameMode === "human") {
                // äººå½¢æ¨¡å¼
                targetElement.classList.remove('circle-target');
                targetElement.innerHTML = `
                    <div class="head" id="head"></div>
                    <div class="body"></div>
                    <div class="arm-left"></div>
                    <div class="arm-right"></div>
                    <div class="leg-left"></div>
                    <div class="leg-right"></div>
                `;
                
                // æ›´æ–°èªªæ˜æ–‡æœ¬
                document.querySelector("#start-screen p").innerHTML = 'å°„æ“Šäººå½¢é¶å­çš„<strong>é ­éƒ¨</strong>ç²å¾—åˆ†æ•¸ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼';
                
                // ç‚ºé ­éƒ¨æ·»åŠ å°„æ“Šäº‹ä»¶ - ä½¿ç”¨mousedownè€Œä¸æ˜¯click
                setTimeout(() => {
                    const head = document.getElementById('head');
                    if (head) {
                        // å…ˆç§»é™¤å¯èƒ½å­˜åœ¨çš„äº‹ä»¶ç›£è½å™¨
                        head.removeEventListener('mousedown', handleHeadClick);
                        head.removeEventListener('touchstart', handleHeadTouchStart);
                        
                        // æ·»åŠ é˜²æ­¢æ‹–æ›³å’Œé¸å–çš„å±¬æ€§
                        head.setAttribute('draggable', 'false');
                        
                        // æ·»åŠ æ–°çš„äº‹ä»¶ç›£è½å™¨
                        head.addEventListener('mousedown', handleHeadClick);
                        // ç‚ºç§»å‹•è¨­å‚™æ·»åŠ è§¸æ‘¸äº‹ä»¶
                        head.addEventListener('touchstart', handleHeadTouchStart);
                    }
                    
                    // æ‡‰ç”¨æ¨™é¶é¡è‰²
                    document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                        el.style.backgroundColor = targetColor;
                    });
                }, 0);
                
                // ç‚ºé¶å­å…¶ä»–éƒ¨ä½æ·»åŠ é»æ“Šäº‹ä»¶
                targetElement.addEventListener('mousedown', function(e) {
                    if (!isPlaying || isPaused || e.target.id === 'head') return;
                    
                    // é˜²æ­¢é»˜èªè¡Œç‚º
                    e.preventDefault();
                    
                    // å¢åŠ å°„æ“Šç¸½æ•¸
                    shotsFired++;
                    
                    // æ’­æ”¾å¤±æ•—éŸ³æ•ˆ
                    playSound('miss');
                    
                    // å‰µå»ºå½ˆå­”æ•ˆæœ
                    createBulletHole(e.clientX, e.clientY);
                    
                    // é»æ“Šå…¶ä»–éƒ¨ä½ä¸è¨ˆåˆ†ï¼Œä¹Ÿä¸ç§»å‹•é¶å­
                    // æ·»åŠ è¦–è¦ºåé¥‹
                    this.classList.add('missed');
                    setTimeout(() => {
                        this.classList.remove('missed');
                    }, 200);
                    
                    // é‡ç½®é€£æ“Š
                    resetCombo();
                    
                    // æ²’å°„åˆ°é¶å­é ­éƒ¨æ‰£ä¸€åˆ†
                    if (score > 0) {
                        score--;
                        scoreDisplay.textContent = score;
                        showFloatingText('-1åˆ†', e.clientX, e.clientY, 'penalty-text');
                    }
                });
                
                // ç‚ºç§»å‹•è¨­å‚™æ·»åŠ è§¸æ‘¸äº‹ä»¶
                targetElement.addEventListener('touchstart', function(e) {
                    if (!isPlaying || isPaused || e.target.id === 'head') return;
                    
                    // é˜²æ­¢è§¸æ‘¸äº‹ä»¶çš„é»˜èªè¡Œç‚ºå’Œæ»¾å‹•
                    e.preventDefault();
                    
                    const touch = e.touches[0];
                    
                    // å¢åŠ å°„æ“Šç¸½æ•¸
                    shotsFired++;
                    
                    // æ’­æ”¾å¤±æ•—éŸ³æ•ˆ
                    playSound('miss');
                    
                    // å‰µå»ºå½ˆå­”æ•ˆæœ
                    createBulletHole(touch.clientX, touch.clientY);
                    
                    // æ·»åŠ è¦–è¦ºåé¥‹
                    this.classList.add('missed');
                    setTimeout(() => {
                        this.classList.remove('missed');
                    }, 200);
                    
                    // é‡ç½®é€£æ“Š
                    resetCombo();
                    
                    // æ²’å°„åˆ°é¶å­é ­éƒ¨æ‰£ä¸€åˆ†
                    if (score > 0) {
                        score--;
                        scoreDisplay.textContent = score;
                        showFloatingText('-1åˆ†', touch.clientX, touch.clientY, 'penalty-text');
                    }
                });
            } else {
                // é¶å¿ƒæ¨¡å¼
                // å…ˆç§»é™¤èˆŠçš„å…ƒç´ 
                const oldTarget = targetElement;
                const newTarget = oldTarget.cloneNode(false);
                oldTarget.parentNode.replaceChild(newTarget, oldTarget);
                
                // è¨­ç½®é¶å¿ƒæ¨£å¼
                newTarget.classList.add('circle-target');
                
                // æ·»åŠ é˜²æ­¢æ‹–æ›³å’Œé¸å–çš„å±¬æ€§
                newTarget.setAttribute('draggable', 'false');
                
                // æ›´æ–°èªªæ˜æ–‡æœ¬
                document.querySelector("#start-screen p").innerHTML = 'é»æ“Šé¶å¿ƒç²å¾—åˆ†æ•¸ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼';
                
                // æ‡‰ç”¨é¶å¿ƒé¡è‰²
                newTarget.style.background = `radial-gradient(circle, white 10%, ${targetColor} 10%, ${targetColor} 30%, white 30%, white 50%, ${adjustColor(targetColor, -20)} 50%, ${adjustColor(targetColor, -20)} 70%, white 70%)`;
                
                // ç‚ºæ•´å€‹é¶å¿ƒæ·»åŠ å°„æ“Šäº‹ä»¶ - ä½¿ç”¨mousedownè€Œä¸æ˜¯click
                newTarget.addEventListener('mousedown', handleTargetClick);
                
                // ç‚ºç§»å‹•è¨­å‚™æ·»åŠ è§¸æ‘¸äº‹ä»¶
                newTarget.addEventListener('touchstart', handleTargetTouchStart);
            }
            
            // æ‡‰ç”¨é›£åº¦è¨­ç½®
            setDifficulty(currentDifficulty);
        }
        
        // è¨­ç½®é›£åº¦
        function setDifficulty(level) {
            currentDifficulty = level;
            
            // æ›´æ–°ç›®æ¨™å¤§å°
            const scale = difficulties[level].targetSize;
            const targetElement = getTarget();
            if (targetElement) {
                targetElement.style.transform = `scale(${scale})`;
            }
            
            // ä¿å­˜é›£åº¦è¨­ç½®
            saveGameSettings();
        }
        
        // æ›´æ–°é›£åº¦æŒ‰éˆ•
        function updateDifficultyButtons(activeDifficulty) {
            document.querySelectorAll('.diff-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`${activeDifficulty}-button`).classList.add('active');
        }
        
        // åˆ‡æ›éŠæˆ²æ¨¡å¼
        function toggleGameMode() {
            // å¦‚æœéŠæˆ²æ­£åœ¨é€²è¡Œï¼Œå…ˆçµæŸç•¶å‰éŠæˆ²
            if (isPlaying) {
                endGame();
                
                // ä¿®å¾©æ¨¡å¼åˆ‡æ›bugï¼šå¼·åˆ¶é‡ç½®éŠæˆ²ç‹€æ…‹
                setTimeout(() => {
                    // åˆ‡æ›æ¨¡å¼
                    gameMode = gameMode === "human" ? "target" : "human";
                    
                    // æ›´æ–°åˆ‡æ›æŒ‰éˆ•æ–‡æœ¬
                    document.getElementById('toggle-mode-button').textContent = 
                        gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
                    
                    homeToggleModeButton.textContent = 
                        gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
                        
                    // æ›´æ–°ç•¶å‰æ¨¡å¼é¡¯ç¤º
                    currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
                    
                    // é‡æ–°è¨­ç½®é¶å­
                    setupTargetByMode();
                    
                    // ä¿å­˜è¨­ç½®
                    saveGameSettings();
                    
                    // é¡¯ç¤ºé–‹å§‹ç•«é¢
                    showStartScreen();
                }, 300); // æ·»åŠ å»¶é²ä»¥ç¢ºä¿éŠæˆ²æ­£ç¢ºçµæŸ
                
                return;
            }
            
            // è‹¥ä¸åœ¨éŠæˆ²ä¸­ï¼Œç›´æ¥åˆ‡æ›æ¨¡å¼
            gameMode = gameMode === "human" ? "target" : "human";
            
            // æ›´æ–°åˆ‡æ›æŒ‰éˆ•æ–‡æœ¬
            document.getElementById('toggle-mode-button').textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
            
            homeToggleModeButton.textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
                
            // æ›´æ–°ç•¶å‰æ¨¡å¼é¡¯ç¤º
            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
            
            // ä¿å­˜è¨­ç½®
            saveGameSettings();
            
            // é‡æ–°è¨­ç½®é¶å­
            setupTargetByMode();
            
            // åˆ¤æ–·ç•¶å‰é¡¯ç¤ºçš„æ˜¯å“ªå€‹ç•«é¢
            if (homeScreen.style.display === 'flex') {
                // å¦‚æœæ˜¯é¦–é ï¼Œä¿æŒåœ¨é¦–é 
                showHome();
            } else {
                // å¦å‰‡é¡¯ç¤ºé–‹å§‹ç•«é¢
                showStartScreen();
            }
        }
        
        // å‰µå»ºå€’æ•¸è¨ˆæ™‚
        function showCountdown(callback) {
            const countdown = document.createElement('div');
            countdown.classList.add('countdown');
            gameContainer.appendChild(countdown);
            
            let count = 3;
            countdown.textContent = count;
            
            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdown.textContent = count;
                    countdown.classList.add('countdown-pulse');
                    // æ’­æ”¾å€’æ•¸éŸ³æ•ˆ
                    playSound('gameStart');
                    setTimeout(() => {
                        countdown.classList.remove('countdown-pulse');
                    }, 900);
                } else {
                    clearInterval(interval);
                    countdown.textContent = 'é–‹å§‹ï¼';
                    setTimeout(() => {
                        countdown.remove();
                        if (callback) callback();
                    }, 1000);
                }
            }, 1000);
        }
        
        // é–‹å§‹éŠæˆ²
        function startGame() {
            if (isPlaying) return;
            
            // é—œé–‰è¨­å®šé¢æ¿å’Œæ­·å²è¨˜éŒ„é¢æ¿
            document.getElementById('settings-panel').classList.remove('show-settings');
            document.getElementById('history-panel').classList.remove('show-history');
            
            initGame();
            homeScreen.style.display = 'none';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            
            // é¡¯ç¤º3ç§’å€’æ•¸è¨ˆæ™‚
            showCountdown(() => {
                getTarget().style.display = 'block';
                isPlaying = true;
                
                // æ’­æ”¾é–‹å§‹éŸ³æ•ˆ
                playSound('gameStart');
                
                // å•Ÿå‹•èƒŒæ™¯éŸ³æ¨‚
                playSound('bgm');
                
                // éš¨æ©Ÿæ”¾ç½®é¶å­
                placeTargetRandomly();
                
                // é–‹å§‹è¨ˆæ™‚å™¨
                gameInterval = setInterval(() => {
                    timeLeft--;
                    timeLeftDisplay.textContent = timeLeft;
                    
                    // ç•¶å‰©é¤˜æ™‚é–“å°‘æ–¼10ç§’æ™‚ï¼Œæ·»åŠ è­¦å‘Šæ•ˆæœ
                    if (timeLeft <= 10) {
                        timeLeftDisplay.classList.add('time-warning');
                    }
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            });
        }
        
        // çµæŸéŠæˆ²
        function endGame() {
            isPlaying = false;
            isPaused = false; // é‡ç½®æš«åœç‹€æ…‹
            clearInterval(gameInterval);
            getTarget().style.display = 'none';
            
            // éš±è—æš«åœè¦†è“‹å±¤
            document.getElementById('pause-overlay').style.display = 'none';
            
            // åœæ­¢èƒŒæ™¯éŸ³æ¨‚
            if (sounds.bgm) {
                sounds.bgm.pause();
                sounds.bgm.currentTime = 0;
            }
            
            // æ’­æ”¾çµæŸéŸ³æ•ˆ
            playSound('gameEnd');
            
            // éš±è—é€£æ“Šé¡¯ç¤º
            comboDisplay.style.display = 'none';
            
            // æ·»åŠ çµæŸå‹•ç•«
            endScreen.classList.add('fade-in');
            endScreen.style.display = 'flex';
            
            // æ›´æ–°çµæŸç•«é¢æ•¸æ“š
            finalScoreDisplay.textContent = score;
            maxComboDisplay.textContent = maxCombo;
            accuracyDisplay.textContent = shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) + '%' : '0%';
            bonusPointsDisplay.textContent = bonusPoints;
            
            // æ›´æ–°å‘½ä¸­æ¬¡æ•¸å’Œæœªå‘½ä¸­æ¬¡æ•¸
            document.getElementById('shots-hit').textContent = shotsHit;
            document.getElementById('shots-missed').textContent = shotsFired - shotsHit;
            
            // æ›´æ–°æœ€é«˜åˆ†
            if (score > highScore) {
                highScore = score;
                highScoreDisplay.textContent = highScore;
                
                // ä¿å­˜æœ€é«˜åˆ†
                saveGameSettings();
                
                // æ·»åŠ æ–°ç´€éŒ„å‹•ç•«
                showNewRecord();
            }
            
            // æ·»åŠ éŠæˆ²æ­·å²ç´€éŒ„
            addGameRecord();
            
            // é‡ç½®æ™‚é–“è­¦å‘Šæ¨£å¼
            timeLeftDisplay.classList.remove('time-warning');
        }
        
        // æ·»åŠ éŠæˆ²ç´€éŒ„
        function addGameRecord() {
            // å‰µå»ºæ–°è¨˜éŒ„
            const newRecord = {
                date: new Date().toLocaleString(),
                score: score,
                mode: gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ",
                moveType: moveType === "transition" ? "æ¼¸è®Šç§»å‹•" : "ç¬é–“ç§»å‹•",
                accuracy: shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) : 0
            };
            
            // å°‡è¨˜éŒ„æ·»åŠ åˆ°æ•¸çµ„é–‹é ­ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            gameHistory.unshift(newRecord);
            
            // é™åˆ¶æ­·å²è¨˜éŒ„é•·åº¦ç‚º10
            if (gameHistory.length > 10) {
                gameHistory = gameHistory.slice(0, 10);
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
            saveGameHistory();
            
            // æ›´æ–°é¡¯ç¤º
            updateHistoryDisplay();
        }
        
        // ä¿å­˜éŠæˆ²æ­·å²åˆ°localStorage
        function saveGameHistory() {
            try {
                localStorage.setItem('shootingGameHistory', JSON.stringify(gameHistory));
            } catch (e) {
                console.error('ä¿å­˜éŠæˆ²æ­·å²å¤±æ•—:', e);
            }
        }
        
        // è¼‰å…¥éŠæˆ²æ­·å²
        function loadGameHistory() {
            try {
                const savedHistory = localStorage.getItem('shootingGameHistory');
                if (savedHistory) {
                    gameHistory = JSON.parse(savedHistory);
                    updateHistoryDisplay();
                }
            } catch (e) {
                console.error('è¼‰å…¥éŠæˆ²æ­·å²å¤±æ•—:', e);
                gameHistory = [];
            }
        }
        
        // æ›´æ–°æ­·å²ç´€éŒ„é¡¯ç¤ºï¼ˆæ’è¡Œæ¦œå½¢å¼ï¼‰
        function updateHistoryDisplay() {
            const historyRecords = document.getElementById('history-records');
            
            if (!historyRecords) {
                console.error('æ‰¾ä¸åˆ°history-recordså…ƒç´ ');
                return;
            }
            
            // é¦–å…ˆæ¸…ç©ºç¾æœ‰å…§å®¹
            historyRecords.innerHTML = '';
            
            // å¦‚æœæ²’æœ‰è¨˜éŒ„ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯
            if (gameHistory.length === 0) {
                historyRecords.innerHTML = '<div class="no-records">å°šç„¡éŠæˆ²ç´€éŒ„</div>';
                return;
            }
            
            // æ’åºæ­·å²è¨˜éŒ„ï¼ˆæŒ‰åˆ†æ•¸é™åºï¼‰
            const sortedHistory = [...gameHistory].sort((a, b) => b.score - a.score);
            
            // æ›´æ–°æ­·å²è¨˜éŒ„é¢æ¿æ¨™é¡Œ
            document.querySelector('.history-panel h2').textContent = 'éŠæˆ²æ’è¡Œæ¦œ';
            
            // ç”ŸæˆHTML
            sortedHistory.forEach((record, index) => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                // æ’å
                const rankSpan = document.createElement('div');
                rankSpan.className = 'record-rank';
                if (index < 3) rankSpan.classList.add('top-rank'); // å‰ä¸‰åç‰¹æ®Šæ¨£å¼
                rankSpan.textContent = index + 1;
                
                // è¨˜éŒ„ä¿¡æ¯
                const infoDiv = document.createElement('div');
                infoDiv.className = 'record-info';
                
                const dateDiv = document.createElement('div');
                dateDiv.className = 'record-date';
                dateDiv.textContent = record.date;
                
                const modeDiv = document.createElement('div');
                modeDiv.className = 'record-mode';
                modeDiv.textContent = `${record.mode} / ${record.moveType}`;
                
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'record-score';
                scoreDiv.textContent = `åˆ†æ•¸: ${record.score}`;
                
                const accuracyDiv = document.createElement('div');
                accuracyDiv.className = 'record-accuracy';
                accuracyDiv.textContent = `å‘½ä¸­ç‡: ${record.accuracy}%`;
                
                // çµ„åˆæ‰€æœ‰å…ƒç´ 
                infoDiv.appendChild(dateDiv);
                infoDiv.appendChild(modeDiv);
                infoDiv.appendChild(scoreDiv);
                infoDiv.appendChild(accuracyDiv);
                
                recordItem.appendChild(rankSpan);
                recordItem.appendChild(infoDiv);
                
                historyRecords.appendChild(recordItem);
            });
        }
        
        // æš«åœéŠæˆ²
        function pauseGame() {
            if (!isPlaying || isPaused) return;
            
            isPaused = true;
            clearInterval(gameInterval);
            
            // é¡¯ç¤ºæš«åœè¦†è“‹å±¤
            document.getElementById('pause-overlay').style.display = 'flex';
            
            // æ›´æ–°æš«åœæŒ‰éˆ•æ–‡å­—
            document.getElementById('pause-game-button').textContent = 'ç¹¼çºŒ';
        }
        
        // ç¹¼çºŒéŠæˆ²
        function resumeGame() {
            if (!isPlaying || !isPaused) return;
            
            isPaused = false;
            
            // éš±è—æš«åœè¦†è“‹å±¤
            document.getElementById('pause-overlay').style.display = 'none';
            
            // æ›´æ–°æš«åœæŒ‰éˆ•æ–‡å­—
            document.getElementById('pause-game-button').textContent = 'æš«åœ';
            
            // é‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨
            gameInterval = setInterval(() => {
                timeLeft--;
                timeLeftDisplay.textContent = timeLeft;
                
                // ç•¶å‰©é¤˜æ™‚é–“å°‘æ–¼10ç§’æ™‚ï¼Œæ·»åŠ è­¦å‘Šæ•ˆæœ
                if (timeLeft <= 10) {
                    timeLeftDisplay.classList.add('time-warning');
                }
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        // æš«åœ/ç¹¼çºŒæŒ‰éˆ•é»æ“Š
        document.getElementById('pause-game-button').addEventListener('click', function() {
            if (isPaused) {
                resumeGame();
            } else {
                pauseGame();
            }
        });
        
        // è¦†è“‹å±¤ç¹¼çºŒæŒ‰éˆ•é»æ“Š
        document.getElementById('resume-button').addEventListener('click', resumeGame);
        
        // è¦†è“‹å±¤çµæŸéŠæˆ²æŒ‰éˆ•é»æ“Š
        document.getElementById('pause-end-game').addEventListener('click', endGame);
        
        // æ­·å²ç´€éŒ„æŒ‰éˆ•é»æ“Š
        document.getElementById('history-button').addEventListener('click', function() {
            // å…ˆé—œé–‰è¨­å®šé¢æ¿ï¼ˆå¦‚æœæ‰“é–‹çš„è©±ï¼‰
            document.getElementById('settings-panel').classList.remove('show-settings');
            
            // åˆ‡æ›æ­·å²è¨˜éŒ„é¢æ¿é¡¯ç¤ºç‹€æ…‹
            document.getElementById('history-panel').classList.toggle('show-history');
            
            // æ›´æ–°æ­·å²è¨˜éŒ„é¡¯ç¤º
            updateHistoryDisplay();
        });
        
        // é—œé–‰æ­·å²è¨˜éŒ„æŒ‰éˆ•é»æ“Š
        document.getElementById('close-history').addEventListener('click', function() {
            document.getElementById('history-panel').classList.remove('show-history');
        });
        
        // è¨­ç½®æŒ‰éˆ•é»æ“Š
        document.getElementById('settings-button').addEventListener('click', function() {
            const settingsPanel = document.getElementById('settings-panel');
            settingsPanel.classList.toggle('show-settings');
            
            // å¦‚æœé¦–æ¬¡æ‰“é–‹è¨­å®šé¢æ¿ï¼Œç¢ºä¿åˆå§‹åŒ–ç§»å‹•æ–¹å¼æŒ‰éˆ•å’Œé¡è‰²é¸æ“‡å™¨
            if (settingsPanel.classList.contains('show-settings')) {
                setupMoveTypeButtons();
                setupColorOptions();
            }
        });
        
        // è¨­ç½®èƒŒæ™¯é¡è‰²
        function setBgColor(color) {
            bgColor = color;
            
            // æ‡‰ç”¨é¡è‰²
            document.querySelector('.game-container').style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -20)})`;
            
            // ä¿å­˜è¨­ç½®
            saveColorSettings();
        }
        
        // è¨­ç½®æ¨™é¶é¡è‰²
        function setTargetColor(color) {
            targetColor = color;
            
            // æ‡‰ç”¨é¡è‰²
            const target = getTarget();
            if (gameMode === "human") {
                // äººå½¢æ¨¡å¼
                document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                    el.style.backgroundColor = color;
                });
            } else {
                // é¶å¿ƒæ¨¡å¼ - é€™éƒ¨åˆ†éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œå› ç‚ºé¶å¿ƒä½¿ç”¨èƒŒæ™¯æ¼¸è®Š
                if (target) {
                    target.style.background = `radial-gradient(circle, white 10%, ${color} 10%, ${color} 30%, white 30%, white 50%, ${adjustColor(color, -20)} 50%, ${adjustColor(color, -20)} 70%, white 70%)`;
                }
            }
            
            // ä¿å­˜è¨­ç½®
            saveColorSettings();
        }
        
        // ä¿å­˜é¡è‰²è¨­å®š
        function saveColorSettings() {
            try {
                localStorage.setItem('shootingGameBgColor', bgColor);
                localStorage.setItem('shootingGameTargetColor', targetColor);
            } catch (e) {
                console.error('ä¿å­˜é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }
        
        // è¼‰å…¥é¡è‰²è¨­å®š
        function loadColorSettings() {
            try {
                const savedBgColor = localStorage.getItem('shootingGameBgColor');
                const savedTargetColor = localStorage.getItem('shootingGameTargetColor');
                
                if (savedBgColor) {
                    bgColor = savedBgColor;
                }
                
                if (savedTargetColor) {
                    targetColor = savedTargetColor;
                }
                
                // æ‡‰ç”¨é¡è‰²
                setBgColor(bgColor);
                setTargetColor(targetColor);
            } catch (e) {
                console.error('è¼‰å…¥é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }
        
        // èª¿æ•´é¡è‰²æ˜æš—
        function adjustColor(color, amount) {
            // å°‡é¡è‰²è½‰æ›ç‚ºRGB
            let r = parseInt(color.substring(1, 3), 16);
            let g = parseInt(color.substring(3, 5), 16);
            let b = parseInt(color.substring(5, 7), 16);
            
            // èª¿æ•´äº®åº¦
            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));
            
            // è½‰å›åå…­é€²åˆ¶
            return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        
        // è™•ç†é ­éƒ¨é»æ“Š
        function handleHeadClick(e) {
            if (!isPlaying || isPaused) return; // æ·»åŠ æš«åœæª¢æŸ¥
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ–‡å­—é¸å–
            e.preventDefault();
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            e.stopPropagation();
            
            // å¢åŠ å°„æ“Šç¸½æ•¸å’Œå‘½ä¸­æ•¸
            shotsFired++;
            shotsHit++;
            
            // æ·»åŠ åˆ†æ•¸
            score++;
            scoreDisplay.textContent = score;
            
            // æ’­æ”¾å‘½ä¸­éŸ³æ•ˆ
            playSound('hit');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(e.clientX, e.clientY);
            
            // å‰µå»ºå‘½ä¸­ç‰¹æ•ˆ
            createHitEffect(this);
            
            // å‰µå»ºç²’å­æ•ˆæœ
            createParticles(e.clientX, e.clientY, '#4cc9f0');
            
            // æ›´æ–°é€£æ“Š
            updateCombo();
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(false);
            
            // é»æ“Šå¾Œç«‹å³éš¨æ©Ÿæ”¾ç½®é¶å­
            placeTargetRandomly();
        }
        
        // è™•ç†é ­éƒ¨è§¸æ‘¸ (ç§»å‹•è¨­å‚™)
        function handleHeadTouchStart(e) {
            if (!isPlaying) return;
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ»¾å‹•
            e.preventDefault();
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            e.stopPropagation();
            
            // ç²å–è§¸æ‘¸ä½ç½®
            const touch = e.touches[0];
            
            // å¢åŠ å°„æ“Šç¸½æ•¸å’Œå‘½ä¸­æ•¸
            shotsFired++;
            shotsHit++;
            
            // æ·»åŠ åˆ†æ•¸
            score++;
            scoreDisplay.textContent = score;
            
            // æ’­æ”¾å‘½ä¸­éŸ³æ•ˆ
            playSound('hit');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(touch.clientX, touch.clientY);
            
            // å‰µå»ºå‘½ä¸­ç‰¹æ•ˆ
            createHitEffect(this);
            
            // å‰µå»ºç²’å­æ•ˆæœ
            createParticles(touch.clientX, touch.clientY, '#4cc9f0');
            
            // æ›´æ–°é€£æ“Š
            updateCombo();
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(false);
            
            // é»æ“Šå¾Œç«‹å³éš¨æ©Ÿæ”¾ç½®é¶å­
            placeTargetRandomly();
        }
        
        // è™•ç†é¶å¿ƒé»æ“Š
        function handleTargetClick(e) {
            if (!isPlaying || isPaused) return; // æ·»åŠ æš«åœæª¢æŸ¥
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ–‡å­—é¸å–
            e.preventDefault();
            
            // å¢åŠ å°„æ“Šç¸½æ•¸å’Œå‘½ä¸­æ•¸
            shotsFired++;
            shotsHit++;
            
            // æ·»åŠ åˆ†æ•¸
            score++;
            scoreDisplay.textContent = score;
            
            // æ’­æ”¾å‘½ä¸­éŸ³æ•ˆ
            playSound('hit');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(e.clientX, e.clientY);
            
            // å‰µå»ºå‘½ä¸­ç‰¹æ•ˆ
            createHitEffect(this);
            
            // å‰µå»ºç²’å­æ•ˆæœ
            createParticles(e.clientX, e.clientY, '#4cc9f0');
            
            // æ›´æ–°é€£æ“Š
            updateCombo();
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(false);
            
            // é»æ“Šå¾Œç«‹å³éš¨æ©Ÿæ”¾ç½®é¶å­
            placeTargetRandomly();
        }
        
        // è™•ç†é¶å¿ƒè§¸æ‘¸ (ç§»å‹•è¨­å‚™)
        function handleTargetTouchStart(e) {
            if (!isPlaying) return;
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ»¾å‹•
            e.preventDefault();
            
            // ç²å–è§¸æ‘¸ä½ç½®
            const touch = e.touches[0];
            
            // å¢åŠ å°„æ“Šç¸½æ•¸å’Œå‘½ä¸­æ•¸
            shotsFired++;
            shotsHit++;
            
            // æ·»åŠ åˆ†æ•¸
            score++;
            scoreDisplay.textContent = score;
            
            // æ’­æ”¾å‘½ä¸­éŸ³æ•ˆ
            playSound('hit');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(touch.clientX, touch.clientY);
            
            // å‰µå»ºå‘½ä¸­ç‰¹æ•ˆ
            createHitEffect(this);
            
            // å‰µå»ºç²’å­æ•ˆæœ
            createParticles(touch.clientX, touch.clientY, '#4cc9f0');
            
            // æ›´æ–°é€£æ“Š
            updateCombo();
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(false);
            
            // é»æ“Šå¾Œç«‹å³éš¨æ©Ÿæ”¾ç½®é¶å­
            placeTargetRandomly();
        }
        
        // èƒŒæ™¯é»æ“Šï¼ˆæœªå‘½ä¸­ï¼‰
        gameContainer.addEventListener('mousedown', function(e) {
            if (!isPlaying || isPaused) return; // æ·»åŠ æš«åœæª¢æŸ¥
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ–‡å­—é¸å–
            e.preventDefault();
            
            // ç¢ºèªé»æ“Šä¸æ˜¯é¶å­æˆ–UIå…ƒç´ 
            if (e.target.closest('.target') || 
                e.target.closest('.info-panel') || 
                e.target.closest('.settings-panel') ||
                e.target.closest('.settings-toggle') ||
                e.target.closest('.history-toggle') ||
                e.target.closest('.history-panel') ||
                e.target.closest('.pause-overlay') ||
                e.target.closest('.combo-display')) return;
            
            // å¢åŠ å°„æ“Šç¸½æ•¸
            shotsFired++;
            
            // æ’­æ”¾å¤±æ•—éŸ³æ•ˆ
            playSound('miss');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(e.clientX, e.clientY);
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(true);
            
            // é‡ç½®é€£æ“Š
            resetCombo();
            
            // æ²’å°„åˆ°é¶å­æ‰£ä¸€åˆ†
            if (score > 0) {
                score--;
                scoreDisplay.textContent = score;
                showFloatingText('-1åˆ†', e.clientX, e.clientY, 'penalty-text');
            }
        });
        
        // èƒŒæ™¯è§¸æ‘¸ï¼ˆæœªå‘½ä¸­ï¼‰- ç§»å‹•è¨­å‚™
        gameContainer.addEventListener('touchstart', function(e) {
            if (!isPlaying || isPaused) return; // æ·»åŠ æš«åœæª¢æŸ¥
            
            // ç¢ºèªè§¸æ‘¸ä¸æ˜¯é¶å­æˆ–UIå…ƒç´ 
            if (e.target.closest('.target') || 
                e.target.closest('.info-panel') || 
                e.target.closest('.settings-panel') ||
                e.target.closest('.settings-toggle') ||
                e.target.closest('.history-toggle') ||
                e.target.closest('.history-panel') ||
                e.target.closest('.pause-overlay') ||
                e.target.closest('.combo-display')) return;
            
            // é˜²æ­¢é»˜èªè¡Œç‚ºå’Œæ»¾å‹•
            e.preventDefault();
            
            // ç²å–è§¸æ‘¸ä½ç½®
            const touch = e.touches[0];
            
            // å¢åŠ å°„æ“Šç¸½æ•¸
            shotsFired++;
            
            // æ’­æ”¾å¤±æ•—éŸ³æ•ˆ
            playSound('miss');
            
            // å‰µå»ºå½ˆå­”æ•ˆæœ
            createBulletHole(touch.clientX, touch.clientY);
            
            // ç•«é¢è¼•å¾®éœ‡å‹•
            screenShake(true);
            
            // é‡ç½®é€£æ“Š
            resetCombo();
            
            // æ²’å°„åˆ°é¶å­æ‰£ä¸€åˆ†
            if (score > 0) {
                score--;
                scoreDisplay.textContent = score;
                showFloatingText('-1åˆ†', touch.clientX, touch.clientY, 'penalty-text');
            }
        });
        
        // æ›´æ–°é€£æ“Š
        function updateCombo() {
            const now = Date.now();
            
            // å¦‚æœ1.5ç§’å…§å†æ¬¡å‘½ä¸­ï¼Œå¢åŠ é€£æ“Š
            if (now - lastHitTime < 1500) {
                combo++;
            } else {
                combo = 1;
            }
            
            lastHitTime = now;
            
            // æ›´æ–°æœ€é«˜é€£æ“Š
            if (combo > maxCombo) {
                maxCombo = combo;
            }
            
            // é¡¯ç¤ºé€£æ“Šè¨ˆæ•¸
            comboDisplay.style.display = 'flex';
            comboCountDisplay.textContent = combo;
            
            // é€£æ“Šçå‹µï¼šæ¯10é€£æ“Šé¡å¤–åŠ 1åˆ†
            if (combo >= 10 && combo % 10 === 0) {
                score++;
                bonusPoints++;
                scoreDisplay.textContent = score;
                showBonusText();
            }
            
            // å¦‚æœé€£æ“Šå¤§æ–¼1ï¼Œé¡¯ç¤ºé€£æ“Šæ–‡æœ¬
            if (combo > 1) {
                showComboText();
            }
        }
        
        // é‡ç½®é€£æ“Š
        function resetCombo() {
            combo = 0;
            comboCountDisplay.textContent = combo;
            comboDisplay.style.display = 'none';
        }
        
        // é¡¯ç¤ºé€£æ“Šæ–‡æœ¬
        function showComboText() {
            const target = getTarget();
            const rect = target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top;
            showFloatingText(`${combo}é€£æ“Šï¼`, x, y, 'combo-text');
        }
        
        // é¡¯ç¤ºçå‹µæ–‡æœ¬
        function showBonusText() {
            const target = getTarget();
            const rect = target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top - 30;
            showFloatingText('+1åˆ†çå‹µï¼', x, y, 'bonus-text');
        }
        
        // é¡¯ç¤ºæ–°ç´€éŒ„å‹•ç•«
        function showNewRecord() {
            const newRecord = document.createElement('div');
            newRecord.classList.add('new-record');
            newRecord.textContent = 'æ–°ç´€éŒ„ï¼';
            endScreen.appendChild(newRecord);
            
            setTimeout(() => {
                newRecord.remove();
            }, 3000);
        }
        
        // é¡¯ç¤ºé£„å­—æ•ˆæœ
        function showFloatingText(text, x, y, className) {
            const floatingText = document.createElement('div');
            floatingText.classList.add('floating-text', className);
            floatingText.textContent = text;
            
            // ç²å–éŠæˆ²å®¹å™¨ä½ç½®
            const rect = gameContainer.getBoundingClientRect();
            
            // è¨ˆç®—åœ¨éŠæˆ²å®¹å™¨å…§çš„ç›¸å°ä½ç½®
            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            floatingText.style.left = `${relativeX}px`;
            floatingText.style.top = `${relativeY}px`;
            gameContainer.appendChild(floatingText);
            
            setTimeout(() => {
                floatingText.remove();
            }, 1000);
        }
        
        // å‰µå»ºå½ˆå­”æ•ˆæœ
        function createBulletHole(x, y) {
            const bulletHole = document.createElement('div');
            bulletHole.classList.add('bullet-hole');
            
            // ç²å–éŠæˆ²å®¹å™¨ä½ç½®
            const rect = gameContainer.getBoundingClientRect();
            
            // è¨ˆç®—åœ¨éŠæˆ²å®¹å™¨å…§çš„ç›¸å°ä½ç½®
            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            bulletHole.style.left = `${relativeX}px`;
            bulletHole.style.top = `${relativeY}px`;
            gameContainer.appendChild(bulletHole);
            
            // æ’­æ”¾å°„æ“ŠéŸ³æ•ˆ
            playSound('shot');
            
            // ç§»é™¤å½ˆå­”ï¼ˆé¿å…å¤ªå¤šå…ƒç´ ï¼‰
            setTimeout(() => {
                bulletHole.remove();
            }, 3000);
        }
        
        // å‰µå»ºå‘½ä¸­é–ƒå…‰æ•ˆæœ
        function createHitEffect(element) {
            element.classList.add('hit-flash');
            setTimeout(() => {
                element.classList.remove('hit-flash');
            }, 200);
        }
        
        // å‰µå»ºç²’å­æ•ˆæœ
        function createParticles(x, y, color) {
            const particleCount = 10;
            
            // ç²å–éŠæˆ²å®¹å™¨ä½ç½®
            const rect = gameContainer.getBoundingClientRect();
            
            // è¨ˆç®—åœ¨éŠæˆ²å®¹å™¨å…§çš„ç›¸å°ä½ç½®
            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // éš¨æ©Ÿå¤§å°
                const size = Math.random() * 5 + 3;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // è¨­ç½®é¡è‰²
                particle.style.backgroundColor = color;
                
                // è¨­ç½®åˆå§‹ä½ç½®
                particle.style.left = `${relativeX}px`;
                particle.style.top = `${relativeY}px`;
                
                // æ·»åŠ åˆ°å®¹å™¨
                gameContainer.appendChild(particle);
                
                // è¨­ç½®éš¨æ©Ÿæ–¹å‘å’Œé€Ÿåº¦
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                // ç²’å­å‹•ç•«
                let posX = relativeX;
                let posY = relativeY;
                
                const animate = () => {
                    // æ›´æ–°ä½ç½®
                    posX += vx;
                    posY += vy;
                    
                    // è¨­ç½®æ–°ä½ç½®
                    particle.style.left = `${posX}px`;
                    particle.style.top = `${posY}px`;
                    
                    // æ·¡å‡ºæ•ˆæœ
                    particle.style.opacity = parseFloat(particle.style.opacity || 1) - 0.02;
                    
                    if (parseFloat(particle.style.opacity) > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                
                requestAnimationFrame(animate);
            }
        }
        
        // ç•«é¢éœ‡å‹•æ•ˆæœ
        function screenShake(isLight) {
            if (isLight) {
                gameContainer.classList.add('screen-shake-light');
                setTimeout(() => {
                    gameContainer.classList.remove('screen-shake-light');
                }, 200);
            } else {
                gameContainer.classList.add('screen-shake');
                setTimeout(() => {
                    gameContainer.classList.remove('screen-shake');
                }, 300);
            }
        }
        
        // ç§»é™¤æ‰€æœ‰èˆ‡æº–å¿ƒç›¸é—œçš„ä»£ç¢¼
        // document.addEventListener('mousemove', (e) => {...});
        
        // é¦–é çš„é–‹å§‹éŠæˆ²æŒ‰éˆ•é»æ“Š
        playButton.addEventListener('click', showStartScreen);
        
        // é–‹å§‹ç•«é¢çš„é–‹å§‹æŒ‰éˆ•é»æ“Š
        startButton.addEventListener('click', startGame);
        
        // çµæŸç•«é¢çš„å†ç©ä¸€æ¬¡æŒ‰éˆ•é»æ“Š
        restartButton.addEventListener('click', startGame);
        
        // çµæŸç•«é¢çš„è¿”å›é¦–é æŒ‰éˆ•é»æ“Š
        homeButton.addEventListener('click', showHome);
        
        // é–‹å§‹ç•«é¢çš„è¿”å›é¦–é æŒ‰éˆ•é»æ“Š
        backToHomeButton.addEventListener('click', showHome);
        
        // çµæŸéŠæˆ²æŒ‰éˆ•é»æ“Š
        document.getElementById('end-game-button').addEventListener('click', endGame);
        
        // é¦–é çš„èªªæ˜æŒ‰éˆ•é»æ“Š
        instructionsButton.addEventListener('click', showInstructions);
        
        // èªªæ˜ç•«é¢çš„è¿”å›æŒ‰éˆ•é»æ“Š
        backFromInstructionsButton.addEventListener('click', showHome);
        
        /* æŒ‰éµç›£è½ - ESCéµçµæŸéŠæˆ² */
        document.addEventListener('keydown', function(e) {
            // ESCéµçµæŸéŠæˆ²
            if (e.key === 'Escape' && isPlaying) {
                endGame();
            }
        });
        
        // åˆ‡æ›æ¨¡å¼æŒ‰éˆ•é»æ“Šï¼ˆé¦–é ï¼‰
        homeToggleModeButton.addEventListener('click', function() {
            // åˆ‡æ›æ¨¡å¼
            gameMode = gameMode === "human" ? "target" : "human";
            
            // æ›´æ–°åˆ‡æ›æŒ‰éˆ•æ–‡æœ¬
            homeToggleModeButton.textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
                
            // æ›´æ–°ç•¶å‰æ¨¡å¼é¡¯ç¤º
            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
            
            // é‡æ–°è¨­ç½®é¶å­
            setupTargetByMode();
        });
        
        // è¨­ç½®é¡è‰²é¸æ“‡å™¨
        function setupColorOptions() {
            // èƒŒæ™¯é¡è‰²é¸æ“‡
            const bgColorOptions = document.querySelectorAll('#bg-color-options .color-option');
            bgColorOptions.forEach(option => {
                // æ¨™è¨˜ç•¶å‰é¸æ“‡çš„é¡è‰²
                if (option.getAttribute('data-color') === bgColor) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                option.addEventListener('click', function() {
                    // æ›´æ–°æ´»å‹•ç‹€æ…‹
                    bgColorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ç²å–é¸æ“‡çš„é¡è‰²
                    const color = this.getAttribute('data-color');
                    
                    // æ›´æ–°èƒŒæ™¯é¡è‰²
                    setBgColor(color);
                    
                    // æ›´æ–°è‡ªå®šç¾©é¡è‰²è¼¸å…¥å€¼
                    document.getElementById('bg-color-custom').value = color;
                });
            });
            
            // æ¨™é¶é¡è‰²é¸æ“‡
            const targetColorOptions = document.querySelectorAll('#target-color-options .color-option');
            targetColorOptions.forEach(option => {
                // æ¨™è¨˜ç•¶å‰é¸æ“‡çš„é¡è‰²
                if (option.getAttribute('data-color') === targetColor) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                option.addEventListener('click', function() {
                    // æ›´æ–°æ´»å‹•ç‹€æ…‹
                    targetColorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ç²å–é¸æ“‡çš„é¡è‰²
                    const color = this.getAttribute('data-color');
                    
                    // æ›´æ–°æ¨™é¶é¡è‰²
                    setTargetColor(color);
                    
                    // æ›´æ–°è‡ªå®šç¾©é¡è‰²è¼¸å…¥å€¼
                    document.getElementById('target-color-custom').value = color;
                });
            });
            
            // è‡ªå®šç¾©èƒŒæ™¯é¡è‰²
            document.getElementById('bg-color-apply').addEventListener('click', function() {
                const customColor = document.getElementById('bg-color-custom').value;
                
                // å»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
                bgColorOptions.forEach(opt => opt.classList.remove('active'));
                
                // æª¢æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„é è¨­é¡è‰²
                let matchFound = false;
                bgColorOptions.forEach(opt => {
                    if (opt.getAttribute('data-color') === customColor) {
                        opt.classList.add('active');
                        matchFound = true;
                    }
                });
                
                // æ›´æ–°èƒŒæ™¯é¡è‰²
                setBgColor(customColor);
            });
            
            // è‡ªå®šç¾©æ¨™é¶é¡è‰²
            document.getElementById('target-color-apply').addEventListener('click', function() {
                const customColor = document.getElementById('target-color-custom').value;
                
                // å»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
                targetColorOptions.forEach(opt => opt.classList.remove('active'));
                
                // æª¢æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„é è¨­é¡è‰²
                let matchFound = false;
                targetColorOptions.forEach(opt => {
                    if (opt.getAttribute('data-color') === customColor) {
                        opt.classList.add('active');
                        matchFound = true;
                    }
                });
                
                // æ›´æ–°æ¨™é¶é¡è‰²
                setTargetColor(customColor);
            });
            
            // è¨­ç½®è‡ªå®šç¾©é¡è‰²è¼¸å…¥å™¨çš„åˆå§‹å€¼
            document.getElementById('bg-color-custom').value = bgColor;
            document.getElementById('target-color-custom').value = targetColor;
        }
        
        // è¨­ç½®èƒŒæ™¯é¡è‰²
        function setBgColor(color) {
            bgColor = color;
            
            // æ‡‰ç”¨é¡è‰²
            document.querySelector('.game-container').style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -20)})`;
            
            // ä¿å­˜è¨­ç½®
            saveColorSettings();
        }
        
        // è¨­ç½®æ¨™é¶é¡è‰²
        function setTargetColor(color) {
            targetColor = color;
            
            // æ‡‰ç”¨é¡è‰²
            const target = getTarget();
            if (gameMode === "human") {
                // äººå½¢æ¨¡å¼
                document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                    el.style.backgroundColor = color;
                });
            } else {
                // é¶å¿ƒæ¨¡å¼ - é€™éƒ¨åˆ†éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œå› ç‚ºé¶å¿ƒä½¿ç”¨èƒŒæ™¯æ¼¸è®Š
                if (target) {
                    target.style.background = `radial-gradient(circle, white 10%, ${color} 10%, ${color} 30%, white 30%, white 50%, ${adjustColor(color, -20)} 50%, ${adjustColor(color, -20)} 70%, white 70%)`;
                }
            }
            
            // ä¿å­˜è¨­ç½®
            saveColorSettings();
        }
        
        // ä¿å­˜é¡è‰²è¨­å®š
        function saveColorSettings() {
            try {
                localStorage.setItem('shootingGameBgColor', bgColor);
                localStorage.setItem('shootingGameTargetColor', targetColor);
            } catch (e) {
                console.error('ä¿å­˜é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }
        
        // è¼‰å…¥é¡è‰²è¨­å®š
        function loadColorSettings() {
            try {
                const savedBgColor = localStorage.getItem('shootingGameBgColor');
                const savedTargetColor = localStorage.getItem('shootingGameTargetColor');
                
                if (savedBgColor) {
                    bgColor = savedBgColor;
                }
                
                if (savedTargetColor) {
                    targetColor = savedTargetColor;
                }
                
                // æ‡‰ç”¨é¡è‰²
                setBgColor(bgColor);
                setTargetColor(targetColor);
            } catch (e) {
                console.error('è¼‰å…¥é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }
        
        // èª¿æ•´é¡è‰²æ˜æš—
        function adjustColor(color, amount) {
            // å°‡é¡è‰²è½‰æ›ç‚ºRGB
            let r = parseInt(color.substring(1, 3), 16);
            let g = parseInt(color.substring(3, 5), 16);
            let b = parseInt(color.substring(5, 7), 16);
            
            // èª¿æ•´äº®åº¦
            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));
            
            // è½‰å›åå…­é€²åˆ¶
            return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        
        document.getElementById('close-settings').addEventListener('click', function() {
            document.getElementById('settings-panel').classList.remove('show-settings');
        });
        
        // é›£åº¦æŒ‰éˆ•äº‹ä»¶è™•ç†
        document.getElementById('easy-button').addEventListener('click', function() {
            setDifficulty('easy');
            updateDifficultyButtons('easy');
        });
        
        document.getElementById('medium-button').addEventListener('click', function() {
            setDifficulty('medium');
            updateDifficultyButtons('medium');
        });
        
        document.getElementById('hard-button').addEventListener('click', function() {
            setDifficulty('hard');
            updateDifficultyButtons('hard');
        });
        
        // è¨­ç½®é¶å­ç§»å‹•æ–¹å¼
        function setMoveType(type) {
            moveType = type;
            console.log(`ç§»å‹•æ–¹å¼å·²è¨­ç½®ç‚º: ${type}`);
            
            // æ›´æ–°é¡¯ç¤ºçš„ç§»å‹•æ–¹å¼
            const moveTypeDisplay = document.getElementById('current-move-type');
            if (moveTypeDisplay) {
                moveTypeDisplay.textContent = type === 'transition' ? 'æ¼¸è®Šç§»å‹•' : 'ç¬é–“ç§»å‹•';
            } else {
                console.error('æ‰¾ä¸åˆ°ç§»å‹•æ–¹å¼é¡¯ç¤ºå…ƒç´ ');
            }
            
            // ç«‹å³æ›´æ–°é¶å­çš„transitionå±¬æ€§
            if (isPlaying) {
                const targetElement = getTarget();
                if (targetElement) {
                    targetElement.style.transition = type === 'transition' 
                        ? `left ${difficulties[currentDifficulty].targetSpeed}ms, top ${difficulties[currentDifficulty].targetSpeed}ms`
                        : 'none';
                }
            }
            
            // ä¿å­˜ç§»å‹•æ–¹å¼è¨­ç½®
            saveGameSettings();
        }
        
        // éŸ³é‡æ§åˆ¶äº‹ä»¶è™•ç†
        document.getElementById('volume-control').addEventListener('input', function(e) {
            soundSettings.volume = parseFloat(e.target.value);
            
            // æ›´æ–°æ‰€æœ‰éŸ³æ•ˆçš„éŸ³é‡
            Object.values(sounds).forEach(sound => {
                sound.volume = soundSettings.volume;
            });
            
            // ä¿å­˜è²éŸ³è¨­ç½®
            saveGameSettings();
        });
        
        // éœéŸ³åˆ‡æ›äº‹ä»¶è™•ç†
        document.getElementById('mute-toggle').addEventListener('change', function(e) {
            soundSettings.muted = e.target.checked;
            
            // æ›´æ–°æ‰€æœ‰éŸ³æ•ˆçš„éœéŸ³ç‹€æ…‹
            Object.values(sounds).forEach(sound => {
                sound.muted = soundSettings.muted;
            });
            
            // ä¿å­˜è²éŸ³è¨­ç½®
            saveGameSettings();
        });
        
        // åˆå§‹è¨­ç½®æ¨¡å¼æŒ‰éˆ•æ–‡æœ¬
        document.getElementById('toggle-mode-button').textContent = "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼";
        homeToggleModeButton.textContent = "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼";
        
        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', function() {
            // é˜²æ­¢æ–‡å­—é¸å–
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });
            
            // é˜²æ­¢æ‹–æ›³
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
            });
            
            // åˆå§‹åŒ–éŸ³æ•ˆ
            initSounds();
            
            // ç¢ºèªéŸ³æ•ˆåˆå§‹åŒ–å¾Œé€²è¡Œé¡å¤–æª¢æŸ¥
            setTimeout(() => {
                // æª¢æŸ¥shot.mp3æ˜¯å¦æˆåŠŸåŠ è¼‰
                const shotSound = document.getElementById('sound-shot');
                if (shotSound && shotSound.src) {
                    console.log('å°„æ“ŠéŸ³æ•ˆå·²è¼‰å…¥:', shotSound.src);
                    // ä¸»å‹•åŠ è¼‰
                    shotSound.load();
                } else {
                    console.error('æ‰¾ä¸åˆ°å°„æ“ŠéŸ³æ•ˆå…ƒç´ æˆ–å…¶æºæ–‡ä»¶');
                }
            }, 500); // å»¶é²æª¢æŸ¥ä»¥ç¢ºä¿DOMå®Œå…¨åŠ è¼‰
            
            // åŠ è¼‰é¡è‰²è¨­å®š
            loadColorSettings();
            
            // è¼‰å…¥éŠæˆ²è¨­ç½®
            loadGameSettings();
            
            // è¼‰å…¥éŠæˆ²æ­·å²ç´€éŒ„
            loadGameHistory();
            
            // åˆå§‹åŒ–éŠæˆ²
            initGame();
            
            // åˆå§‹åŒ–é¡è‰²é¸æ“‡å™¨
            setupColorOptions();
            
            // èª¿æ•´éŠæˆ²å®¹å™¨å¤§å°ä»¥é©æ‡‰è¢å¹•
            adjustGameContainerSize();
            
            // ç›£è½è¦–çª—å¤§å°è®ŠåŒ–
            window.addEventListener('resize', adjustGameContainerSize);
            
            // é¡¯ç¤ºé¦–é 
            showHome();
            
            // å»¶é²åŠ è¼‰ç§»å‹•æ–¹å¼æŒ‰éˆ•è¨­ç½®ï¼Œç¢ºä¿DOMå…ƒç´ å·²å®Œå…¨åŠ è¼‰
            setTimeout(setupMoveTypeButtons, 500);
            
            // æ¸¬è©¦æº–å‚™å¥½ï¼Œæ·»åŠ ä¸€å€‹æç¤º
            console.log('éŠæˆ²åˆå§‹åŒ–å®Œæˆ');
        });
        
        // èª¿æ•´éŠæˆ²å®¹å™¨å¤§å°
        function adjustGameContainerSize() {
            // ä½¿éŠæˆ²å®¹å™¨å¡«æ»¿æ•´å€‹è¦–çª—
            gameContainer.style.width = `${window.innerWidth}px`;
            gameContainer.style.height = `${window.innerHeight}px`;
            
            // ç¢ºä¿CSSè‡ªå®šç¾©å±¬æ€§æ‡‰ç”¨åˆ°æ•´å€‹æ–‡æª”
            document.body.style.overflow = 'hidden';
            document.documentElement.style.overflow = 'hidden';
            
            // é˜²æ­¢é•·æŒ‰é¸å–å’Œå³éµèœå–®
            document.body.style.webkitTouchCallout = 'none'; // iOS Safari
            document.body.style.webkitUserSelect = 'none';   // Safari
            document.body.style.khtmlUserSelect = 'none';    // Konqueror HTML
            document.body.style.mozUserSelect = 'none';      // Firefox
            document.body.style.msUserSelect = 'none';       // Internet Explorer/Edge
            document.body.style.userSelect = 'none';         // Non-prefixed version
            
            // å¦‚æœæ¨™é¶å·²é¡¯ç¤ºï¼Œé‡æ–°è¨ˆç®—å…¶ä½ç½®
            if (isPlaying && !isPaused) {
                placeTargetRandomly();
            }
        }
        
        // è¨­ç½®ç§»å‹•æ–¹å¼æŒ‰éˆ•
        function setupMoveTypeButtons() {
            // æ›´æ–°ç§»å‹•æ–¹å¼æŒ‰éˆ•
            function updateMoveTypeButtons(activeType) {
                document.querySelectorAll('.move-button').forEach(button => {
                    button.classList.remove('active');
                });
                document.getElementById(`${activeType}-move`).classList.add('active');
            }
            
            // ç¢ºä¿ç§»å‹•é¡å‹æŒ‰éˆ•å·²ç¶“å­˜åœ¨å†æ·»åŠ äº‹ä»¶
            const transitionButton = document.getElementById('transition-move');
            const instantButton = document.getElementById('instant-move');
            
            if (transitionButton && instantButton) {
                // ç§»å‹•æ–¹å¼æŒ‰éˆ•äº‹ä»¶è™•ç†
                transitionButton.addEventListener('click', function() {
                    setMoveType('transition');
                    updateMoveTypeButtons('transition');
                    console.log('è¨­ç½®ç‚ºæ¼¸è®Šç§»å‹•');
                });
                
                instantButton.addEventListener('click', function() {
                    setMoveType('instant');
                    updateMoveTypeButtons('instant');
                    console.log('è¨­ç½®ç‚ºç¬é–“ç§»å‹•');
                });
            } else {
                console.error('æ‰¾ä¸åˆ°ç§»å‹•æ–¹å¼æŒ‰éˆ•');
            }
        }
        
        // éš¨æ©Ÿæ”¾ç½®é¶å­
        function placeTargetRandomly() {
            const target = getTarget();
            if (!target) return;
            
            // ç²å–éŠæˆ²å®¹å™¨å°ºå¯¸
            const gameContainer = document.getElementById('game-container');
            const containerWidth = gameContainer.clientWidth;
            const containerHeight = gameContainer.clientHeight;
            
            // ç²å–é¶å­å°ºå¯¸
            const targetWidth = target.offsetWidth;
            const targetHeight = target.offsetHeight;
            
            // è¨­ç½®é‚Šç•Œï¼Œé¿å…é¶å­éƒ¨åˆ†è¶…å‡ºå®¹å™¨
            const maxX = containerWidth - targetWidth;
            const maxY = containerHeight - targetHeight;
            
            // è¨­ç½®ä¸Šé‚Šç•Œï¼Œç¢ºä¿é¶å­ä¸æœƒå‡ºç¾åœ¨ä¿¡æ¯é¢æ¿å€åŸŸ
            const minY = 70; // ä¿¡æ¯é¢æ¿çš„é«˜åº¦å¤§ç´„ç‚º70px
            
            // ç”Ÿæˆéš¨æ©Ÿä½ç½®
            let randomX = Math.floor(Math.random() * maxX);
            let randomY = Math.floor(Math.random() * (maxY - minY)) + minY;
            
            // è¨­ç½®é¶å­çš„ç§»å‹•éæ¸¡æ•ˆæœ
            if (moveType === 'transition') {
                target.style.transition = `left ${difficulties[currentDifficulty].targetSpeed}ms, top ${difficulties[currentDifficulty].targetSpeed}ms`;
            } else {
                target.style.transition = 'none';
            }
            
            // è¨­ç½®é¶å­ä½ç½®
            target.style.left = `${randomX}px`;
            target.style.top = `${randomY}px`;
        }

        // ä¿å­˜éŠæˆ²è¨­ç½®åˆ°localStorage
        function saveGameSettings() {
            try {
                // ä¿å­˜æœ€é«˜åˆ†
                localStorage.setItem('shootingGameHighScore', highScore);
                
                // ä¿å­˜é›£åº¦è¨­å®š
                localStorage.setItem('shootingGameDifficulty', currentDifficulty);
                
                // ä¿å­˜ç§»å‹•æ–¹å¼
                localStorage.setItem('shootingGameMoveType', moveType);
                
                // ä¿å­˜éŠæˆ²æ¨¡å¼
                localStorage.setItem('shootingGameMode', gameMode);
                
                // ä¿å­˜è²éŸ³è¨­å®š
                localStorage.setItem('shootingGameSoundSettings', JSON.stringify(soundSettings));
                
                console.log('éŠæˆ²è¨­ç½®ä¿å­˜æˆåŠŸ');
            } catch (e) {
                console.error('ä¿å­˜éŠæˆ²è¨­ç½®å¤±æ•—:', e);
            }
        }

        // è¼‰å…¥éŠæˆ²è¨­ç½®
        function loadGameSettings() {
            try {
                // è¼‰å…¥æœ€é«˜åˆ†
                const savedHighScore = localStorage.getItem('shootingGameHighScore');
                if (savedHighScore) {
                    highScore = parseInt(savedHighScore);
                    highScoreDisplay.textContent = highScore;
                }
                
                // è¼‰å…¥é›£åº¦è¨­å®š
                const savedDifficulty = localStorage.getItem('shootingGameDifficulty');
                if (savedDifficulty && difficulties[savedDifficulty]) {
                    currentDifficulty = savedDifficulty;
                    // æ›´æ–°é›£åº¦æŒ‰éˆ•
                    updateDifficultyButtons(currentDifficulty);
                }
                
                // è¼‰å…¥ç§»å‹•æ–¹å¼
                const savedMoveType = localStorage.getItem('shootingGameMoveType');
                if (savedMoveType && (savedMoveType === 'transition' || savedMoveType === 'instant')) {
                    moveType = savedMoveType;
                    // æ›´æ–°ç§»å‹•æ–¹å¼æŒ‰éˆ•æœƒåœ¨setupMoveTypeButtonså‡½æ•¸ä¸­è™•ç†
                }
                
                // è¼‰å…¥éŠæˆ²æ¨¡å¼
                const savedGameMode = localStorage.getItem('shootingGameMode');
                if (savedGameMode && (savedGameMode === 'human' || savedGameMode === 'target')) {
                    gameMode = savedGameMode;
                    // æ›´æ–°éŠæˆ²æ¨¡å¼é¡¯ç¤º
                    currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
                }
                
                // è¼‰å…¥è²éŸ³è¨­å®š
                const savedSoundSettings = localStorage.getItem('shootingGameSoundSettings');
                if (savedSoundSettings) {
                    const parsedSettings = JSON.parse(savedSoundSettings);
                    soundSettings.volume = parsedSettings.volume;
                    soundSettings.muted = parsedSettings.muted;
                    
                    // æ›´æ–°éŸ³é‡æ§åˆ¶å…ƒç´ 
                    document.getElementById('volume-control').value = soundSettings.volume;
                    document.getElementById('mute-toggle').checked = soundSettings.muted;
                }
                
                console.log('éŠæˆ²è¨­ç½®è¼‰å…¥æˆåŠŸ');
            } catch (e) {
                console.error('è¼‰å…¥éŠæˆ²è¨­ç½®å¤±æ•—:', e);
            }
        }

    </script>
</body>
</html>
