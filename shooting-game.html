<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="å°„æ“ŠæŒ‘æˆ°æ˜¯ä¸€æ¬¾è€ƒé©—ç²¾æº–åº¦èˆ‡åæ‡‰é€Ÿåº¦çš„ç¶²é å°„æ“ŠéŠæˆ²ã€‚æŒ‘æˆ°ä¸åŒé›£åº¦ç­‰ç´šï¼Œç´¯ç©é€£æ“Šå–å¾—é«˜åˆ†ï¼Œæ”¯æ´å¤šç¨®éŠæˆ²æ¨¡å¼ï¼Œé©åˆæ‰€æœ‰ä¼‘é–’éŠæˆ²æ„›å¥½è€…ã€‚äº«å—æµæš¢çš„å°„æ“Šé«”é©—ï¼ŒæŒ‘æˆ°ä½ çš„æ¥µé™ï¼">
    <meta name="keywords" content="å°„æ“ŠéŠæˆ², å°„æ“ŠæŒ‘æˆ°, ç¶²é éŠæˆ², HTML5éŠæˆ², ç²¾æº–ç„æº–, é€£æ“Šç³»çµ±, è¨ˆæ™‚æŒ‘æˆ°, åæ‡‰è¨“ç·´, åˆ†æ•¸æ’è¡Œ, å¤šç¨®é›£åº¦, ç„æº–è¨“ç·´, ä¼‘é–’éŠæˆ², ç€è¦½å™¨éŠæˆ²">
    <link rel="icon" href="images/favicon.jpg" type="image/jpg">
    <title>å°„æ“ŠæŒ‘æˆ°</title>
    
    <!-- Firebase SDK v11 -->
    <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation; 
            -webkit-user-select: none;  
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            background-color: #1a1a2e;
            color: #fff;
            overflow: hidden; 
        }
        
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16213e, #0f3460);
            border: none;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .home-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16213e, #0f3460);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 20px 20px;
            z-index: 20;
            transition: all 0.5s ease;
            overflow-y: auto;
            gap: 15px;
        }
        
        .game-title {
            text-align: center;
            margin-bottom: 5px;
        }
        
        .game-title h1 {
            font-size: 52px;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 0 0 15px rgba(80, 140, 255, 0.7);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(80, 140, 255, 0.7); }
            to { text-shadow: 0 0 20px rgba(80, 140, 255, 0.9), 0 0 30px rgba(80, 140, 255, 0.6); }
        }
        
        .subtitle {
            font-size: 22px;
            color: #e2e2e2;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .game-menu {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 280px;
        }
        
        .menu-button {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 100%;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .menu-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #4895ef, #3f37c9);
        }
        
        .menu-button:active {
            transform: translateY(-2px);
        }
        
        .game-info {
            text-align: center;
            margin-top: 30px;
            font-size: 16px;
            background-color: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            width: 280px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .mode-display, .high-score {
            margin: 8px 0;
        }
        
        .high-score span {
            color: #4cc9f0;
            font-weight: bold;
        }
        
        .player-name-input {
            margin: 8px 0;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .player-name-input label {
            font-size: 14px;
            color: #e2e2e2;
        }
        
        .player-name-input input {
            padding: 8px 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .player-name-input input:focus {
            outline: none;
            border-color: #4cc9f0;
            box-shadow: 0 0 10px rgba(76, 201, 240, 0.3);
        }
        
        .player-name-input input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .footer {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin-top: 10px;
        }

        /* é¦–é æ»¾å‹•æ¢æ¨£å¼ */
        .home-screen::-webkit-scrollbar {
            width: 8px;
        }
        
        .home-screen::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .home-screen::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .home-screen::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }

        .instructions-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.95);
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px 30px;
            z-index: 15;
            transition: all 0.5s ease;
        }
        
        .instructions-content {
            max-width: 600px;
            margin: 10px 0 20px 0;
            line-height: 1.6;
            max-height: 70vh;
            overflow-y: auto;
            padding: 0 15px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2);
        }
        
        .instructions-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .instructions-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .instructions-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .instructions-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .instructions-content h2 {
            margin: 20px 0 10px;
            color: #4cc9f0;
            font-size: 22px;
        }
        
        .instructions-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions-content li {
            margin-bottom: 8px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .target {
            position: absolute;
            width: 100px;
            height: 180px;
            cursor: crosshair;
            display: none;
            transition: transform 0.2s ease;
            touch-action: none; 
        }
        
        .target.circle-target {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, white 10%, #4d96ff 10%, #4d96ff 30%, white 30%, white 50%, #3a84e8 50%, #3a84e8 70%, white 70%);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.7);
        }
        
        .target.circle-target:active {
            transform: scale(0.9);
        }
        
        .head {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #4d96ff;
            border-radius: 50%;
            top: 0;
            left: 30px;
            transition: transform 0.1s;
            border: 2px solid #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .head:active {
            transform: scale(0.9);
        }
        
        .body {
            position: absolute;
            width: 50px;
            height: 80px;
            background-color: #4d96ff;
            top: 40px;
            left: 25px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .arm-left, .arm-right {
            position: absolute;
            width: 15px;
            height: 60px;
            background-color: #4d96ff;
            top: 45px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .arm-left {
            left: 10px;
        }
        
        .arm-right {
            right: 10px;
        }
        
        .leg-left, .leg-right {
            position: absolute;
            width: 15px;
            height: 60px;
            background-color: #4d96ff;
            top: 120px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .leg-left {
            left: 25px;
        }
        
        .leg-right {
            right: 25px;
        }

        .info-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            z-index: 5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .time, .score {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .time i, .score i {
            font-size: 20px;
        }
        
        .time span, .score span {
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .start-screen, .end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: all 0.5s ease;
        }
        
        .missed {
            opacity: 0.7;
            filter: grayscale(50%);
        }
        
        strong {
            color: #fff;
            background-color: #4361ee;
            padding: 0 5px;
            border-radius: 3px;
        }
        
        .end-screen {
            display: none;
        }
        
        .score-display {
            font-size: 64px;
            margin: 30px 0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }
        
        .stats {
            background-color: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-width: 300px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .stat-value {
            font-weight: bold;
            color: #4cc9f0;
        }
        
        button {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #4895ef, #3f37c9);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .small-button {
            padding: 8px 12px;
            font-size: 14px;
            margin: 0 5px;
        }
        
        #end-game-button {
            background: linear-gradient(135deg, #ef476f, #d90429);
        }
        
        #end-game-button:hover {
            background: linear-gradient(135deg, #f25a82, #e71735);
        }
        
        .controls {
            display: flex;
            gap: 8px;
        }
        
        h1 {
            font-size: 40px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .settings-panel {
            position: absolute;
            top: 60px;
            right: -300px;
            width: 280px;
            max-height: 80vh; 
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.95), rgba(15, 52, 96, 0.95));
            padding: 20px;
            border-radius: 10px;
            z-index: 25;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: right 0.4s ease;
            border: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto; 
            scrollbar-width: thin; 
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2); 
        }

        .settings-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .settings-panel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .settings-panel::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .settings-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .settings-panel.show-settings {
            right: 10px;
        }

        .settings-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, #4896ef, #4361ee);
            color: white;
            border: none;
            border-radius: 10px;
            width: auto;
            height: auto;
            padding: 8px 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .settings-toggle::before {
            content: "âš™ï¸";
            font-size: 18px;
        }
        
        .settings-toggle:hover {
            background: linear-gradient(135deg, #5ba3f0, #536cf5);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.4);
        }
        
        .setting-item {
            margin: 15px 0;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .difficulty-buttons {
            display: flex;
            gap: 8px;
        }
        
        .diff-button {
            flex: 1;
            padding: 8px 5px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .diff-button.active {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .move-type-buttons {
            display: flex;
            gap: 8px;
        }
        
        .move-button {
            flex: 1;
            padding: 8px 5px;
            font-size: 14px;
            background: rgba(128,128,128,0.3); 
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.6); 
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .move-button.active {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            color: white; 
        }
        
        .move-button:hover {
            background: rgba(128,128,128,0.5); 
        }
        
        .move-button.active:hover {
            background: linear-gradient(135deg, #5ba3f0, #4361ee);
            transform: translateY(-2px);
        }

        .bullet-hole {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, rgba(0,0,0,0.8) 20%, rgba(50,50,50,0.8) 40%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
            pointer-events: none;
            transform: translate(-50%, -50%);
            box-shadow: inset 0 0 2px rgba(0,0,0,0.8);
        }
        
        .hit-flash {
            animation: flash 0.2s ease-out;
        }
        
        @keyframes flash {
            0% { filter: brightness(1); }
            50% { filter: brightness(3); }
            100% { filter: brightness(1); }
        }
        
        .screen-shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake {
            10%, 90% { transform: translate(-1px, -1px); }
            20%, 80% { transform: translate(2px, 2px); }
            30%, 70% { transform: translate(-2px, -2px); }
            40%, 60% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
        }
        
        .screen-shake-light {
            animation: shake-light 0.2s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake-light {
            10%, 90% { transform: translate(-0.5px, -0.5px); }
            20%, 80% { transform: translate(1px, 1px); }
            30%, 70% { transform: translate(-1px, -1px); }
            40%, 60% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
        }

        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(67, 97, 238, 0.8);
            z-index: 15;
            transition: all 0.3s ease;
        }
        
        .countdown-pulse {
            animation: pulse 0.9s cubic-bezier(0.5, 0, 0.5, 1);
            transform: translate(-50%, -50%) scale(1);
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .floating-text {
            position: absolute;
            color: white;
            font-size: 18px;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            animation: float-up 1s ease-out forwards;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 5px rgba(0,0,0,0.7);
        }
        
        .combo-text {
            color: #ffcc00;
            text-shadow: 0 0 5px rgba(255, 204, 0, 0.7);
        }
        
        .bonus-text {
            color: #ff3399;
            text-shadow: 0 0 5px rgba(255, 51, 153, 0.7);
        }
        
        .penalty-text {
            color: #ff3333;
            text-shadow: 0 0 5px rgba(255, 51, 51, 0.7);
            font-weight: bold;
        }
        
        @keyframes float-up {
            0% { transform: translate(-50%, -50%); opacity: 1; }
            100% { transform: translate(-50%, -100px); opacity: 0; }
        }

        .time-warning {
            animation: pulse-warning 1s infinite;
            color: #ff3333 !important;
        }
        
        @keyframes pulse-warning {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .new-record {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f72585, #7209b7);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            animation: bounce 2s infinite;
            box-shadow: 0 0 20px rgba(247, 37, 133, 0.7);
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-20px); }
            60% { transform: translateX(-50%) translateY(-10px); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .particle {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }

        .combo-display {
            position: absolute;
            right: 15px;
            bottom: 15px;
            background: rgba(0,0,0,0.6);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .combo-count {
            font-weight: bold;
            color: #ffcc00;
        }

        .game-container {
            cursor: crosshair;
        }

        .leaderboard-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16213e, #0f3460);
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            z-index: 20;
            overflow-y: auto;
        }
        
        .leaderboard-screen h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 0 0 15px rgba(80, 140, 255, 0.7);
        }
        
        .leaderboard-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .filter-button.active {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            border-color: #4361ee;
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }
        
        .leaderboard-content {
            width: 100%;
            max-width: 600px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 4px solid #4cc9f0;
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        
        .rank-number {
            background: linear-gradient(135deg, #f72585, #7209b7);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .rank-number.top-rank {
            background: linear-gradient(135deg, #ffd60a, #ff8500);
            box-shadow: 0 0 15px rgba(255, 214, 10, 0.5);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 16px;
            color: #fff;
            margin-bottom: 4px;
        }
        
        .game-details {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .score-display {
            font-size: 24px;
            font-weight: bold;
            color: #4cc9f0;
            margin-left: 10px;
        }
        
        .loading-message, .no-records {
            text-align: center;
            color: rgba(255,255,255,0.6);
            padding: 40px 20px;
            font-style: italic;
        }
        
        .upload-status {
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .upload-status.success {
            background: rgba(76, 201, 240, 0.2);
            border: 1px solid #4cc9f0;
        }
        
        .upload-status.error {
            background: rgba(247, 37, 133, 0.2);
            border: 1px solid #f72585;
        }
        
        .close-button {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .close-button:hover {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        html, body, div, span, h1, h2, h3, p, a, button, input, label,
        .game-container, .target, .head, .body, .home-screen, .start-screen,
        .end-screen, .instructions-screen, .info-panel, .settings-panel,
        .game-title, .subtitle, .game-menu, .game-info,
        .footer, .settings-toggle, .menu-button, .combo-display,
        .floating-text, .countdown {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
            -webkit-tap-highlight-color: transparent;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.8);
        }
        
        .color-option.active {
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .color-custom {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .color-input {
            width: 60px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 0;
            background: none;
        }
        
        .color-input::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .color-input::-webkit-color-swatch {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
        }
        
        .color-apply {
            padding: 5px 10px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .color-apply:hover {
            background: linear-gradient(135deg, #4895ef, #3f37c9);
            transform: translateY(-2px);
        }

        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 20;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .pause-overlay h2 {
            font-size: 48px;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 0 15px rgba(76, 201, 240, 0.8);
        }
        
        .pause-controls {
            display: flex;
            gap: 20px;
        }
        
        #resume-button {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
        }
        
        #resume-button:hover {
            background: linear-gradient(135deg, #49d5ff, #536dff);
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.8);
        }
        
        .color-option.active {
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        @media screen and (max-width: 768px) {
            .home-screen {
                padding: 15px 15px;
                gap: 10px;
            }
            
            .game-title h1 {
                font-size: 36px;
                margin-bottom: 5px;
            }
            
            .subtitle {
                font-size: 16px;
            }
            
            .game-menu {
                width: 80%;
                max-width: 300px;
            }
            
            .game-info {
                width: 80%;
                max-width: 300px;
                padding: 10px;
            }
            
            .player-name-input {
                margin: 5px 0;
            }
            
            .player-name-input input {
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .settings-panel {
                width: 90%;
                max-width: 300px;
            }
        }

        @media screen and (max-height: 600px) {
            .home-screen {
                padding: 10px 20px;
                gap: 8px;
            }
            
            .game-title h1 {
                font-size: 32px;
                margin-bottom: 3px;
            }
            
            .game-title {
                margin-bottom: 0px;
            }
            
            .game-menu {
                gap: 8px;
            }
            
            .menu-button {
                padding: 10px 15px;
                font-size: 16px;
            }
            
            .game-info {
                padding: 10px;
            }
            
            .footer {
                margin-top: 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container" id="game-container">
        
        <div class="info-panel">
            <div class="time"><i class="fas fa-clock"></i>æ™‚é–“: <span id="time-left">60</span></div>
            <div class="controls">
                <button id="pause-game-button" class="small-button">æš«åœ</button>
                <button id="end-game-button" class="small-button">çµæŸéŠæˆ²</button>
            </div>
            <div class="score"><i class="fas fa-star"></i>åˆ†æ•¸: <span id="score">0</span></div>
        </div>

        <div class="combo-display" id="combo-display" style="display: none;">
            é€£æ“Š: <span id="combo-count" class="combo-count">0</span>
        </div>

        <div class="target" id="target">
            <div class="head" id="head"></div>
            <div class="body"></div>
            <div class="arm-left"></div>
            <div class="arm-right"></div>
            <div class="leg-left"></div>
            <div class="leg-right"></div>
        </div>

        <div class="home-screen" id="home-screen">
            
            <button id="settings-button" class="settings-toggle">è¨­å®š</button>

            
            <div class="game-title">
                <h1>å°„æ“ŠæŒ‘æˆ°</h1>
                <div class="subtitle">ç²¾æº–ç„æº–ï¼Œå¿«é€Ÿåæ‡‰</div>
            </div>
            
            <div class="game-menu">
                <button id="play-button" class="menu-button">é–‹å§‹éŠæˆ²</button>
                <button id="home-toggle-mode" class="menu-button">åˆ‡æ›æ¨¡å¼</button>
                <button id="leaderboard-button" class="menu-button">å…¨çƒæ’è¡Œæ¦œ</button>
                <button id="instructions-button" class="menu-button">éŠæˆ²èªªæ˜</button>
            </div>
            
            <div class="game-info">
                <div class="player-name-input">
                    <label for="player-name">ç©å®¶åç¨±:</label>
                    <input type="text" id="player-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„åç¨±" maxlength="20">
                </div>
                <div class="mode-display">
                    ç•¶å‰æ¨¡å¼: <span id="current-mode">äººå½¢é¶å­</span>
                </div>
                <div class="move-display">
                    ç§»å‹•æ–¹å¼: <span id="current-move-type">æ¼¸è®Šç§»å‹•</span>
                </div>
                <div class="high-score">
                    æœ€é«˜åˆ†æ•¸: <span id="high-score">0</span>
                </div>
            </div>
            
            <div class="footer">
                å°„æ“ŠæŒ‘æˆ°éŠæˆ² &copy; 2025
            </div>
        </div>

        <div class="start-screen" id="start-screen">
            <h1>å°„æ“ŠæŒ‘æˆ°éŠæˆ²</h1>
            <p>å°„æ“Šäººå½¢é¶å­çš„<strong>é ­éƒ¨</strong>ç²å¾—åˆ†æ•¸ï¼Œ<strong>æ²’å°„ä¸­æœƒæ‰£1åˆ†</strong>ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼</p>
            <div class="button-group">
                <button id="start-button">é–‹å§‹éŠæˆ²</button>
                <button id="back-to-home">è¿”å›é¦–é </button>
            </div>
        </div>

        <div class="instructions-screen" id="instructions-screen">
            <h1>éŠæˆ²èªªæ˜</h1>
            <div class="instructions-content">
                <h2>éŠæˆ²æ¨¡å¼</h2>
                <p><strong>äººå½¢æ¨¡å¼ï¼š</strong>å°„æ“Šäººå½¢é¶å­çš„é ­éƒ¨æ‰èƒ½å¾—åˆ†ï¼Œå…¶ä»–éƒ¨ä½é»æ“Šç„¡æ•ˆã€‚</p>
                <p><strong>é¶å¿ƒæ¨¡å¼ï¼š</strong>å°„æ“Šåœ“å½¢é¶å¿ƒçš„ä»»ä½•éƒ¨ä½éƒ½å¯å¾—åˆ†ã€‚</p>
                
                <h2>éŠæˆ²è¦å‰‡</h2>
                <ul>
                    <li>éŠæˆ²æ™‚é–“ç‚º60ç§’</li>
                    <li>å°„æ“Šæœ‰æ•ˆç›®æ¨™å¾Œï¼Œç›®æ¨™æœƒéš¨æ©Ÿç§»å‹•ä½ç½®</li>
                    <li>æ¯æ¬¡å°„æ“ŠæˆåŠŸå¾—1åˆ†</li>
                    <li>æ²’å°„åˆ°é¶å­æœƒæ‰£1åˆ†</li>
                    <li>é€£çºŒå‘½ä¸­å¯ç²å¾—é€£æ“ŠåŠ æˆ</li>
                    <li>æ¯10é€£æ“Šå¯ç²å¾—é¡å¤–çå‹µåˆ†æ•¸1åˆ†</li>
                    <li>å¯ä»¥éš¨æ™‚çµæŸéŠæˆ²æˆ–æš«åœéŠæˆ²</li>
                </ul>
                
                <h2>é›£åº¦è¨­å®š</h2>
                <ul>
                    <li><strong>ç°¡å–®ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦æ…¢ï¼Œå°ºå¯¸è¼ƒå¤§</li>
                    <li><strong>ä¸­ç­‰ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦ä¸­ç­‰ï¼Œæ¨™æº–å°ºå¯¸</li>
                    <li><strong>å›°é›£ï¼š</strong>ç›®æ¨™ç§»å‹•é€Ÿåº¦å¿«ï¼Œå°ºå¯¸è¼ƒå°</li>
                </ul>
                
                <h2>éŠæˆ²è¨­å®š</h2>
                <ul>
                    <li><strong>é¶å­ç§»å‹•æ–¹å¼ï¼š</strong>å¯é¸æ“‡æ¼¸è®Šç§»å‹•æˆ–ç¬é–“ç§»å‹•</li>
                    <li><strong>é¡è‰²è¨­å®šï¼š</strong>å¯è‡ªå®šç¾©èƒŒæ™¯å’Œæ¨™é¶é¡è‰²</li>
                    <li><strong>éŸ³æ•ˆè¨­å®šï¼š</strong>å¯èª¿æ•´éŸ³é‡æˆ–è¨­ç‚ºéœéŸ³</li>
                </ul>
                
                <h2>å…¶ä»–åŠŸèƒ½</h2>
                <ul>
                    <li><strong>æš«åœåŠŸèƒ½ï¼š</strong>éŠæˆ²ä¸­å¯éš¨æ™‚æš«åœ</li>
                    <li><strong>æœ€é«˜åˆ†æ•¸ï¼š</strong>è‡ªå‹•è¨˜éŒ„æœ€é«˜åˆ†</li>
                    <li><strong>å…¨çƒæ’è¡Œæ¦œï¼š</strong>èˆ‡å…¨ä¸–ç•Œç©å®¶æ¯”æ‹¼åˆ†æ•¸</li>
                </ul>
            </div>
            <button id="back-from-instructions">è¿”å›é¦–é </button>
        </div>

        <div class="end-screen" id="end-screen">
            <h1>éŠæˆ²çµæŸï¼</h1>
            <div class="score-display">ä½ çš„åˆ†æ•¸: <span id="final-score">0</span></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-name">æœ€é«˜é€£æ“Š:</div>
                    <div class="stat-value" id="max-combo">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">å‘½ä¸­ç‡:</div>
                    <div class="stat-value" id="accuracy">0%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">å‘½ä¸­æ¬¡æ•¸:</div>
                    <div class="stat-value" id="shots-hit">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">æœªå‘½ä¸­æ¬¡æ•¸:</div>
                    <div class="stat-value" id="shots-missed">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-name">çå‹µåˆ†æ•¸:</div>
                    <div class="stat-value" id="bonus-points">0</div>
                </div>
            </div>
            <div class="button-group">
                <button id="restart-button">å†ç©ä¸€æ¬¡</button>
                <button id="home-button">è¿”å›é¦–é </button>
            </div>
        </div>

        <div class="settings-panel" id="settings-panel">
            <h2>éŠæˆ²è¨­å®š</h2>
            <div class="setting-item">
                <label for="volume-control">éŸ³é‡</label>
                <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.7">
            </div>
            <div class="setting-item">
                <label for="mute-toggle">éœéŸ³</label>
                <input type="checkbox" id="mute-toggle">
            </div>
            <div class="setting-item">
                <label>é›£åº¦</label>
                <div class="difficulty-buttons">
                    <button id="easy-button" class="diff-button">ç°¡å–®</button>
                    <button id="medium-button" class="diff-button active">ä¸­ç­‰</button>
                    <button id="hard-button" class="diff-button">å›°é›£</button>
                </div>
            </div>
            <div class="setting-item">
                <label>é¶å­ç§»å‹•æ–¹å¼</label>
                <div class="move-type-buttons">
                    <button id="transition-move" class="move-button active">æ¼¸è®Šç§»å‹•</button>
                    <button id="instant-move" class="move-button">ç¬é–“ç§»å‹•</button>
                </div>
            </div>
            <div class="setting-item">
                <label>èƒŒæ™¯é¡è‰²</label>
                <div class="color-options" id="bg-color-options">
                    <div class="color-option" data-color="#16213e" style="background-color: #16213e;"></div>
                    <div class="color-option" data-color="#1a1a2e" style="background-color: #1a1a2e;"></div>
                    <div class="color-option" data-color="#3a0ca3" style="background-color: #3a0ca3;"></div>
                    <div class="color-option" data-color="#3d405b" style="background-color: #3d405b;"></div>
                    <div class="color-option" data-color="#3d0066" style="background-color: #3d0066;"></div>
                    <div class="color-option" data-color="#242423" style="background-color: #242423;"></div>
                    <div class="color-option" data-color="#1b4332" style="background-color: #1b4332;"></div>
                    <div class="color-option" data-color="#582f0e" style="background-color: #582f0e;"></div>
                    <div class="color-option" data-color="#023047" style="background-color: #023047;"></div>
                    <div class="color-option" data-color="#370617" style="background-color: #370617;"></div>
                    <div class="color-option" data-color="#000814" style="background-color: #000814;"></div>
                    <div class="color-option" data-color="#540b0e" style="background-color: #540b0e;"></div>
                </div>
                <div class="color-custom">
                    <input type="color" id="bg-color-custom" class="color-input" value="#16213e">
                    <button id="bg-color-apply" class="color-apply">å¥—ç”¨</button>
                </div>
            </div>
            <div class="setting-item">
                <label>æ¨™é¶é¡è‰²</label>
                <div class="color-options" id="target-color-options">
                    <div class="color-option" data-color="#4d96ff" style="background-color: #4d96ff;"></div>
                    <div class="color-option" data-color="#f72585" style="background-color: #f72585;"></div>
                    <div class="color-option" data-color="#4cc9f0" style="background-color: #4cc9f0;"></div>
                    <div class="color-option" data-color="#f77f00" style="background-color: #f77f00;"></div>
                    <div class="color-option" data-color="#2ec4b6" style="background-color: #2ec4b6;"></div>
                    <div class="color-option" data-color="#fb5607" style="background-color: #fb5607;"></div>
                    <div class="color-option" data-color="#70e000" style="background-color: #70e000;"></div>
                    <div class="color-option" data-color="#ff9f1c" style="background-color: #ff9f1c;"></div>
                    <div class="color-option" data-color="#e63946" style="background-color: #e63946;"></div>
                    <div class="color-option" data-color="#588157" style="background-color: #588157;"></div>
                    <div class="color-option" data-color="#06d6a0" style="background-color: #06d6a0;"></div>
                    <div class="color-option" data-color="#ff85a1" style="background-color: #ff85a1;"></div>
                </div>
                <div class="color-custom">
                    <input type="color" id="target-color-custom" class="color-input" value="#4d96ff">
                    <button id="target-color-apply" class="color-apply">å¥—ç”¨</button>
                </div>
            </div>
            <button id="close-settings">é—œé–‰</button>
        </div>


        <div class="pause-overlay" id="pause-overlay">
            <h2>éŠæˆ²æš«åœ</h2>
            <div class="pause-controls">
                <button id="resume-button">ç¹¼çºŒéŠæˆ²</button>
                <button id="pause-end-game">çµæŸéŠæˆ²</button>
            </div>
        </div>

        <div class="leaderboard-screen" id="leaderboard-screen">
            <h1>ğŸ† å…¨çƒæ’è¡Œæ¦œ</h1>
            
            <div class="leaderboard-filters">
                <button id="filter-all" class="filter-button active">å…¨éƒ¨</button>
                <button id="filter-human" class="filter-button">äººå½¢æ¨¡å¼</button>
                <button id="filter-circle" class="filter-button">é¶å¿ƒæ¨¡å¼</button>
                <button id="filter-today" class="filter-button">ä»Šæ—¥</button>
            </div>
            
            <div class="leaderboard-content" id="leaderboard-content">
                <div class="loading-message">è¼‰å…¥ä¸­...</div>
            </div>
            
            <div class="upload-status" id="upload-status" style="display: none;">
                <span id="upload-message"></span>
            </div>
            
            <button id="close-leaderboard" class="close-button">è¿”å›é¦–é </button>
        </div>

        <audio id="sound-shot" src="sounds/shot.mp3" preload="auto"></audio>
        <audio id="sound-hit" src="sounds/hit.mp3" preload="auto"></audio>
        <audio id="sound-miss" src="sounds/miss.mp3" preload="auto"></audio>
        <audio id="sound-game-start" src="sounds/game-start.mp3" preload="auto"></audio>
        <audio id="sound-game-end" src="sounds/game-end.mp3" preload="auto"></audio>
        <audio id="sound-bgm" src="sounds/background-music.mp3" preload="auto" loop></audio>
        
    </div>
    
    <script>
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyB8K49Pme6uCR3WKMjbmXXT8YDbJTJdkoc",
            authDomain: "shooting-game-leaderboard.firebaseapp.com",
            projectId: "shooting-game-leaderboard",
            storageBucket: "shooting-game-leaderboard.firebasestorage.app",
            messagingSenderId: "454346518154",
            appId: "1:454346518154:web:b0610b87774425f57cc773",
            measurementId: "G-RDZDLCPZCL"
        };

        // åˆå§‹åŒ– Firebase
        let db = null;
        let isFirebaseEnabled = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            isFirebaseEnabled = true;
            console.log('Firebase åˆå§‹åŒ–æˆåŠŸ');
            console.log('æ’è¡Œæ¦œåŠŸèƒ½å·²å•Ÿç”¨');
        } catch (error) {
            console.error('Firebase åˆå§‹åŒ–å¤±æ•—:', error);
            console.log('æ’è¡Œæ¦œåŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨');
        }

        const homeScreen = document.getElementById('home-screen');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const instructionsScreen = document.getElementById('instructions-screen');
        const timeLeftDisplay = document.getElementById('time-left');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('final-score');
        const currentModeDisplay = document.getElementById('current-mode');
        const highScoreDisplay = document.getElementById('high-score');
        const startButton = document.getElementById('start-button');
        const playButton = document.getElementById('play-button');
        const restartButton = document.getElementById('restart-button');
        const homeButton = document.getElementById('home-button');
        const backToHomeButton = document.getElementById('back-to-home');
        const instructionsButton = document.getElementById('instructions-button');
        const backFromInstructionsButton = document.getElementById('back-from-instructions');
        const homeToggleModeButton = document.getElementById('home-toggle-mode');
        const gameContainer = document.getElementById('game-container');
        const comboDisplay = document.getElementById('combo-display');
        const comboCountDisplay = document.getElementById('combo-count');
        const maxComboDisplay = document.getElementById('max-combo');
        const accuracyDisplay = document.getElementById('accuracy');
        const bonusPointsDisplay = document.getElementById('bonus-points');
        const crosshair = document.getElementById('crosshair');
        
        // æ’è¡Œæ¦œç›¸é—œå…ƒç´ 
        const leaderboardScreen = document.getElementById('leaderboard-screen');
        const leaderboardButton = document.getElementById('leaderboard-button');
        const closeLeaderboardButton = document.getElementById('close-leaderboard');
        const leaderboardContent = document.getElementById('leaderboard-content');
        const uploadStatus = document.getElementById('upload-status');
        const uploadMessage = document.getElementById('upload-message');
        const playerNameInput = document.getElementById('player-name');

        function getTarget() {
            return document.getElementById('target');
        }

        const sounds = {};

        let score = 0;
        let timeLeft = 60;
        let gameInterval;
        let isPlaying = false;
        let isPaused = false; 
        let gameMode = "human"; 
        let highScore = 0; 
        let combo = 0; 
        let maxCombo = 0; 
        let shotsFired = 0; 
        let shotsHit = 0; 
        let bonusPoints = 0; 
        let lastHitTime = 0; 
        let moveType = "transition"; 
 

        let bgColor = "#16213e"; 
        let targetColor = "#4d96ff"; 

        const difficulties = {
            easy: { targetSpeed: 1000, targetSize: 1.2 },
            medium: { targetSpeed: 700, targetSize: 1.0 },
            hard: { targetSpeed: 400, targetSize: 0.8 }
        };
        
        let currentDifficulty = 'medium'; 

        const soundSettings = {
            volume: 0.7,
            muted: false
        };

        function initSounds() {
            try {

                console.log('é–‹å§‹åˆå§‹åŒ–éŸ³æ•ˆ...');

            sounds.shot = document.getElementById('sound-shot');
            sounds.hit = document.getElementById('sound-hit');
            sounds.miss = document.getElementById('sound-miss');
            sounds.gameStart = document.getElementById('sound-game-start');
            sounds.gameEnd = document.getElementById('sound-game-end');
            sounds.bgm = document.getElementById('sound-bgm');

                Object.entries(sounds).forEach(([key, sound]) => {
                    if (!sound) {
                        console.error(`æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´  ${key}`);
                    } else {
                        console.log(`éŸ³æ•ˆ ${key} åˆå§‹åŒ–æˆåŠŸ, è·¯å¾‘: ${sound.src}`);

                        sound.load();

                sound.volume = soundSettings.volume;

                        sound.onerror = function(e) {
                            console.error(`éŸ³æ•ˆ ${key} åŠ è¼‰å¤±æ•—:`, e);
                            console.error(`å˜—è©¦è¼‰å…¥çš„è·¯å¾‘: ${sound.src}`);
                        };

                        sound.onloadeddata = function() {
                            console.log(`éŸ³æ•ˆ ${key} åŠ è¼‰æˆåŠŸ`);
                        };
                    }
                });

                try {
                    const silentSound = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urqIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIgAP/7UMQAABTBMi8PQZC8DpJ3h+DghVYGnP3N1dfWAAMDAyMECBAgAAGBgZGBAgQIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxCmAEhGNJ+gigGG2jab7IGaAAAAACQQghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjgAAQQQSCCEEIIT//wQgghnhBBBCQQjg");
                    silentSound.volume = 0;
                    silentSound.play().catch(e => {
                        console.warn('ç„¡æ³•æ’­æ”¾éœéŸ³éŸ³é »:', e);
                    });
                } catch (e) {
                    console.warn('å˜—è©¦æ’­æ”¾éœéŸ³éŸ³é »æ™‚å‡ºéŒ¯:', e);
                }
                
                console.log('éŸ³æ•ˆåˆå§‹åŒ–å®Œæˆ');
            } catch (e) {
                console.error('åˆå§‹åŒ–éŸ³æ•ˆæ™‚ç™¼ç”ŸéŒ¯èª¤:', e);
            }
        }

        function playSound(soundName) {

            if (soundSettings.muted) {
                console.log(`éŸ³æ•ˆ ${soundName} è¢«éœéŸ³`);
                return;
            }

            if (!sounds[soundName]) {
                console.error(`éŸ³æ•ˆ ${soundName} ä¸å­˜åœ¨`);

                const audioElement = document.getElementById(`sound-${soundName}`);
                if (audioElement) {
                    console.log(`å˜—è©¦é‡æ–°ç²å–éŸ³æ•ˆå…ƒç´  ${soundName}`);
                    sounds[soundName] = audioElement;
                } else {
                    console.error(`æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´  sound-${soundName}`);
                    return;
                }
            }

            if (sounds[soundName].readyState === 0) {
                console.warn(`éŸ³æ•ˆ ${soundName} å°šæœªåŠ è¼‰å®Œæˆï¼Œå˜—è©¦é‡æ–°è¼‰å…¥`);
                sounds[soundName].load();
            }

            try {
            sounds[soundName].currentTime = 0;
            sounds[soundName].volume = soundSettings.volume;

                const playPromise = sounds[soundName].play();

                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log(`éŸ³æ•ˆ ${soundName} æ’­æ”¾æˆåŠŸ`);
                        })
                        .catch(e => {
                            console.error(`æ’­æ”¾éŸ³æ•ˆ ${soundName} å¤±æ•—:`, e);

                            if (e.name === 'NotAllowedError') {
                                console.warn('æ’­æ”¾éŸ³æ•ˆéœ€è¦ç”¨æˆ¶äº¤äº’ï¼Œå°‡åœ¨ä¸‹ä¸€æ¬¡ç”¨æˆ¶äº¤äº’æ™‚å˜—è©¦æ’­æ”¾');

                                const playOnClick = () => {
                                    sounds[soundName].play()
                                        .then(() => {
                                            document.removeEventListener('click', playOnClick);
                                        })
                                        .catch(innerError => {
                                            console.error('å†æ¬¡å˜—è©¦æ’­æ”¾å¤±æ•—:', innerError);
                                        });
                                };
                                document.addEventListener('click', playOnClick);
                            }
                        });
                }
            } catch (e) {
                console.error(`å˜—è©¦æ’­æ”¾éŸ³æ•ˆ ${soundName} æ™‚ç™¼ç”ŸéŒ¯èª¤:`, e);
            }
        }

        function testSound(soundName) {
            const resultElement = document.getElementById('sound-test-result');
            resultElement.innerHTML = `å˜—è©¦æ’­æ”¾ ${soundName} éŸ³æ•ˆ...`;
            
            try {
                const audioElement = document.getElementById(`sound-${soundName}`);
                if (!audioElement) {
                    resultElement.innerHTML += '<br>æ‰¾ä¸åˆ°éŸ³æ•ˆå…ƒç´ ï¼è«‹æª¢æŸ¥HTMLä¸­çš„audioæ¨™ç±¤ã€‚';
                    return;
                }
                
                resultElement.innerHTML += `<br>éŸ³æ•ˆå…ƒç´ æ‰¾åˆ°: ${audioElement.id}`;
                resultElement.innerHTML += `<br>éŸ³æ•ˆæª”æ¡ˆè·¯å¾‘: ${audioElement.src}`;

                const tempAudio = new Audio();
                tempAudio.onloadeddata = function() {
                    resultElement.innerHTML += '<br>éŸ³æ•ˆæª”æ¡ˆè¼‰å…¥æˆåŠŸï¼';
                    resultElement.innerHTML += '<br>å˜—è©¦æ’­æ”¾...';

                    tempAudio.play()
                        .then(() => {
                            resultElement.innerHTML += '<br><span style="color: #4cc9f0;">æ’­æ”¾æˆåŠŸï¼</span>';
                        })
                        .catch(e => {
                            resultElement.innerHTML += `<br><span style="color: #f72585;">æ’­æ”¾å¤±æ•—: ${e.message}</span>`;
                            resultElement.innerHTML += '<br>å¯èƒ½åŸå› : ç€è¦½å™¨é˜»æ­¢è‡ªå‹•æ’­æ”¾ã€æª”æ¡ˆæå£æˆ–æ ¼å¼ä¸æ”¯æ´';
                        });
                };
                
                tempAudio.onerror = function() {
                    resultElement.innerHTML += `<br><span style="color: #f72585;">éŸ³æ•ˆæª”æ¡ˆè¼‰å…¥å¤±æ•—ï¼</span>`;
                    resultElement.innerHTML += '<br>å¯èƒ½åŸå› : æª”æ¡ˆè·¯å¾‘éŒ¯èª¤ã€æª”æ¡ˆä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ”¯æ´';
                    resultElement.innerHTML += `<br>è«‹æª¢æŸ¥ ${audioElement.src} æ˜¯å¦å­˜åœ¨ä¸”å¯è¨ªå•`;
                };
                
                tempAudio.src = audioElement.src;
            } catch (e) {
                resultElement.innerHTML += `<br><span style="color: #f72585;">éŒ¯èª¤: ${e.message}</span>`;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const openButton = document.getElementById('open-sound-test');
            const closeButton = document.getElementById('close-sound-test');
            const testShotButton = document.getElementById('test-shot-sound');
            const testHitButton = document.getElementById('test-hit-sound');
            const testMissButton = document.getElementById('test-miss-sound');
            const testPanel = document.getElementById('sound-test-panel');
            
            if (openButton) {
                openButton.addEventListener('click', function() {
                    testPanel.style.display = 'block';
                });
            }
            
            if (closeButton) {
                closeButton.addEventListener('click', function() {
                    testPanel.style.display = 'none';
                });
            }
            
            if (testShotButton) {
                testShotButton.addEventListener('click', function() {
                    testSound('shot');
                });
            }
            
            if (testHitButton) {
                testHitButton.addEventListener('click', function() {
                    testSound('hit');
                });
            }
            
            if (testMissButton) {
                testMissButton.addEventListener('click', function() {
                    testSound('miss');
                });
            }
        });

        function initGame() {
            score = 0;
            timeLeft = 60;
            combo = 0;
            maxCombo = 0;
            shotsFired = 0;
            shotsHit = 0;
            bonusPoints = 0;
            
            scoreDisplay.textContent = score;
            timeLeftDisplay.textContent = timeLeft;
            comboCountDisplay.textContent = combo;
            comboDisplay.style.display = 'none';
            
            getTarget().style.display = 'none';
            isPlaying = false;
            clearInterval(gameInterval);

            highScoreDisplay.textContent = highScore;

            setupTargetByMode();

            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";

            document.getElementById('current-move-type').textContent = moveType === 'transition' ? 'æ¼¸è®Šç§»å‹•' : 'ç¬é–“ç§»å‹•';

            document.querySelectorAll('.bullet-hole, .particle, .floating-text').forEach(el => {
                el.remove();
            });

            timeLeftDisplay.classList.remove('time-warning');

            gameContainer.style.cursor = 'crosshair';

            setBgColor(bgColor);
            setTargetColor(targetColor);
        }

        function showHome() {
            homeScreen.style.display = 'flex';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            getTarget().style.display = 'none';

            homeScreen.classList.add('fade-in');
            
            isPlaying = false;
            clearInterval(gameInterval);

            if (sounds.bgm) {
                sounds.bgm.pause();
                sounds.bgm.currentTime = 0;
            }

            highScoreDisplay.textContent = highScore;
            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";
        }

        function showStartScreen() {
            homeScreen.style.display = 'none';
            startScreen.style.display = 'flex';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            getTarget().style.display = 'none';

            document.getElementById('settings-panel').classList.remove('show-settings');

            startScreen.classList.add('slide-in');
        }

        function showInstructions() {
            homeScreen.style.display = 'none';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'flex';
            getTarget().style.display = 'none';

            document.getElementById('settings-panel').classList.remove('show-settings');

            instructionsScreen.classList.add('fade-in');
        }

        function setupTargetByMode() {

            const targetElement = getTarget();

            targetElement.innerHTML = '';
            
            if (gameMode === "human") {

                targetElement.classList.remove('circle-target');
                targetElement.innerHTML = `
                    <div class="head" id="head"></div>
                    <div class="body"></div>
                    <div class="arm-left"></div>
                    <div class="arm-right"></div>
                    <div class="leg-left"></div>
                    <div class="leg-right"></div>
                `;

                document.querySelector("#start-screen p").innerHTML = 'å°„æ“Šäººå½¢é¶å­çš„<strong>é ­éƒ¨</strong>ç²å¾—åˆ†æ•¸ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼';

                setTimeout(() => {
                    const head = document.getElementById('head');
                    if (head) {

                        head.removeEventListener('mousedown', handleHeadClick);
                        head.removeEventListener('touchstart', handleHeadTouchStart);

                        head.setAttribute('draggable', 'false');

                        head.addEventListener('mousedown', handleHeadClick);

                        head.addEventListener('touchstart', handleHeadTouchStart);
                    }

                    document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                        el.style.backgroundColor = targetColor;
                    });
                }, 0);

                targetElement.addEventListener('mousedown', function(e) {
                    if (!isPlaying || isPaused || e.target.id === 'head') return;

                    e.preventDefault();

                    shotsFired++;

                    playSound('miss');

                    createBulletHole(e.clientX, e.clientY);

                    this.classList.add('missed');
                    setTimeout(() => {
                        this.classList.remove('missed');
                    }, 200);

                    resetCombo();

                    if (score > 0) {
                        score--;
                        scoreDisplay.textContent = score;
                        showFloatingText('-1åˆ†', e.clientX, e.clientY, 'penalty-text');
                    }
                });

                targetElement.addEventListener('touchstart', function(e) {
                    if (!isPlaying || isPaused || e.target.id === 'head') return;

                    e.preventDefault();
                    
                    const touch = e.touches[0];

                    shotsFired++;

                    playSound('miss');

                    createBulletHole(touch.clientX, touch.clientY);

                    this.classList.add('missed');
                    setTimeout(() => {
                        this.classList.remove('missed');
                    }, 200);

                    resetCombo();

                    if (score > 0) {
                        score--;
                        scoreDisplay.textContent = score;
                        showFloatingText('-1åˆ†', touch.clientX, touch.clientY, 'penalty-text');
                    }
                });
            } else {

                const oldTarget = targetElement;
                const newTarget = oldTarget.cloneNode(false);
                oldTarget.parentNode.replaceChild(newTarget, oldTarget);

                newTarget.classList.add('circle-target');

                newTarget.setAttribute('draggable', 'false');

                document.querySelector("#start-screen p").innerHTML = 'é»æ“Šé¶å¿ƒç²å¾—åˆ†æ•¸ï¼Œä¸€åˆ†é˜å…§çœ‹çœ‹ä½ èƒ½ç²å¾—å¤šå°‘åˆ†ï¼';

                newTarget.style.background = `radial-gradient(circle, white 10%, ${targetColor} 10%, ${targetColor} 30%, white 30%, white 50%, ${adjustColor(targetColor, -20)} 50%, ${adjustColor(targetColor, -20)} 70%, white 70%)`;

                newTarget.addEventListener('mousedown', handleTargetClick);

                newTarget.addEventListener('touchstart', handleTargetTouchStart);
            }

            setDifficulty(currentDifficulty);
        }

        function setDifficulty(level) {
            currentDifficulty = level;

            const scale = difficulties[level].targetSize;
            const targetElement = getTarget();
            if (targetElement) {
                targetElement.style.transform = `scale(${scale})`;
            }
        }

        function updateDifficultyButtons(activeDifficulty) {
            document.querySelectorAll('.diff-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`${activeDifficulty}-button`).classList.add('active');
        }

        function toggleGameMode() {

            if (isPlaying) {
                endGame();

                setTimeout(() => {

                    gameMode = gameMode === "human" ? "target" : "human";

                    document.getElementById('toggle-mode-button').textContent = 
                        gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
                    
                    homeToggleModeButton.textContent = 
                        gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";

                    currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";

                    setupTargetByMode();

                    showStartScreen();
                }, 300); 
                
                return;
            }

            gameMode = gameMode === "human" ? "target" : "human";

            document.getElementById('toggle-mode-button').textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";
            
            homeToggleModeButton.textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";

            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";

            setupTargetByMode();

            if (homeScreen.style.display === 'flex') {

                showHome();
            } else {

                showStartScreen();
            }
        }

        function showCountdown(callback) {
            const countdown = document.createElement('div');
            countdown.classList.add('countdown');
            gameContainer.appendChild(countdown);
            
            let count = 3;
            countdown.textContent = count;
            
            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdown.textContent = count;
                    countdown.classList.add('countdown-pulse');

                    playSound('gameStart');
                    setTimeout(() => {
                        countdown.classList.remove('countdown-pulse');
                    }, 900);
                } else {
                    clearInterval(interval);
                    countdown.textContent = 'é–‹å§‹ï¼';
                    setTimeout(() => {
                        countdown.remove();
                        if (callback) callback();
                    }, 1000);
                }
            }, 1000);
        }

        function startGame() {
            if (isPlaying) return;

            document.getElementById('settings-panel').classList.remove('show-settings');
            
            initGame();
            homeScreen.style.display = 'none';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';

            showCountdown(() => {
                getTarget().style.display = 'block';
                isPlaying = true;

                playSound('gameStart');

                playSound('bgm');

                placeTargetRandomly();

                gameInterval = setInterval(() => {
                    timeLeft--;
                    timeLeftDisplay.textContent = timeLeft;

                    if (timeLeft <= 10) {
                        timeLeftDisplay.classList.add('time-warning');
                    }
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            });
        }

        function endGame() {
            isPlaying = false;
            isPaused = false; 
            clearInterval(gameInterval);
            getTarget().style.display = 'none';

            document.getElementById('pause-overlay').style.display = 'none';

            if (sounds.bgm) {
                sounds.bgm.pause();
                sounds.bgm.currentTime = 0;
            }

            playSound('gameEnd');

            comboDisplay.style.display = 'none';

            endScreen.classList.add('fade-in');
            endScreen.style.display = 'flex';

            finalScoreDisplay.textContent = score;
            maxComboDisplay.textContent = maxCombo;
            accuracyDisplay.textContent = shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) + '%' : '0%';
            bonusPointsDisplay.textContent = bonusPoints;

            document.getElementById('shots-hit').textContent = shotsHit;
            document.getElementById('shots-missed').textContent = shotsFired - shotsHit;

            if (score > highScore) {
                highScore = score;
                highScoreDisplay.textContent = highScore;

                showNewRecord();
            }

            addGameRecord();
            
            // ä¸Šå‚³åˆ†æ•¸åˆ°æ’è¡Œæ¦œ
            uploadScoreToLeaderboard();

            timeLeftDisplay.classList.remove('time-warning');
        }

        function addGameRecord() {
            const newRecord = {
                date: new Date().toLocaleString(),
                score: score,
                mode: gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ",
                moveType: moveType === "transition" ? "æ¼¸è®Šç§»å‹•" : "ç¬é–“ç§»å‹•",
                accuracy: shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) : 0
            };
        }

        // æ’è¡Œæ¦œåŠŸèƒ½
        async function uploadScoreToLeaderboard() {
            if (!isFirebaseEnabled) {
                console.log('Firebase æœªå•Ÿç”¨ï¼Œè·³éåˆ†æ•¸ä¸Šå‚³');
                return;
            }

            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                showUploadStatus('è«‹è¼¸å…¥ç©å®¶åç¨±æ‰èƒ½ä¸Šå‚³åˆ†æ•¸', 'error');
                return;
            }

            if (playerName.length > 20) {
                showUploadStatus('ç©å®¶åç¨±ä¸èƒ½è¶…é20å€‹å­—ç¬¦', 'error');
                return;
            }

            // é˜²ä½œå¼Šæª¢æŸ¥
            if (score > 1000) {
                console.warn('åˆ†æ•¸ç•°å¸¸é«˜ï¼Œå¯èƒ½å­˜åœ¨ä½œå¼Šè¡Œç‚º');
            }

            const gameRecord = {
                playerName: playerName,
                score: score,
                gameMode: gameMode,
                difficulty: currentDifficulty,
                moveType: moveType,
                accuracy: shotsFired > 0 ? Math.round((shotsHit / shotsFired) * 100) : 0,
                maxCombo: maxCombo,
                shotsHit: shotsHit,
                shotsFired: shotsFired,
                bonusPoints: bonusPoints,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                playTime: 60 - timeLeft,
                ipHash: await getSimpleHash(getClientIP())
            };

            try {
                showUploadStatus('æ­£åœ¨ä¸Šå‚³åˆ†æ•¸...', 'info');
                
                await db.collection('leaderboard').add(gameRecord);
                
                showUploadStatus('åˆ†æ•¸ä¸Šå‚³æˆåŠŸï¼', 'success');
                console.log('åˆ†æ•¸ä¸Šå‚³æˆåŠŸ');
                
                // ä¿å­˜ç©å®¶åç¨±
                localStorage.setItem('shootingGamePlayerName', playerName);
                
            } catch (error) {
                console.error('åˆ†æ•¸ä¸Šå‚³å¤±æ•—:', error);
                showUploadStatus('åˆ†æ•¸ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š', 'error');
            }
        }

        function showUploadStatus(message, type) {
            uploadMessage.textContent = message;
            uploadStatus.className = `upload-status ${type}`;
            uploadStatus.style.display = 'block';
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        }

        async function loadLeaderboard(filter = 'all') {
            if (!isFirebaseEnabled) {
                leaderboardContent.innerHTML = '<div class="no-records">æ’è¡Œæ¦œåŠŸèƒ½éœ€è¦ Firebase é…ç½®</div>';
                return;
            }

            try {
                leaderboardContent.innerHTML = '<div class="loading-message">è¼‰å…¥ä¸­...</div>';
                
                let query = db.collection('leaderboard');
                
                // æ ¹æ“šç¯©é¸æ¢ä»¶èª¿æ•´æŸ¥è©¢
                if (filter === 'human') {
                    query = query.where('gameMode', '==', 'human');
                } else if (filter === 'circle') {
                    query = query.where('gameMode', '==', 'target');
                } else if (filter === 'today') {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    query = query.where('timestamp', '>=', today);
                }
                
                // æŒ‰åˆ†æ•¸é™åºæ’åˆ—ï¼Œé™åˆ¶50æ¢è¨˜éŒ„
                query = query.orderBy('score', 'desc').limit(50);
                
                const snapshot = await query.get();
                const records = [];
                
                snapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                displayLeaderboard(records);
                
            } catch (error) {
                console.error('è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—:', error);
                leaderboardContent.innerHTML = '<div class="no-records">è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            }
        }

        function displayLeaderboard(records) {
            if (records.length === 0) {
                leaderboardContent.innerHTML = '<div class="no-records">æš«ç„¡æ’è¡Œè¨˜éŒ„</div>';
                return;
            }

            let html = '';
            records.forEach((record, index) => {
                const rank = index + 1;
                const isTopRank = rank <= 3;
                const date = record.timestamp ? record.timestamp.toDate().toLocaleDateString() : 'æœªçŸ¥';
                
                html += `
                    <div class="leaderboard-item">
                        <div class="rank-number ${isTopRank ? 'top-rank' : ''}">${rank}</div>
                        <div class="player-info">
                            <div class="player-name">${escapeHtml(record.playerName)}</div>
                            <div class="game-details">
                                <span>æ¨¡å¼: ${record.gameMode === 'human' ? 'äººå½¢' : 'é¶å¿ƒ'}</span>
                                <span>é›£åº¦: ${getDifficultyText(record.difficulty)}</span>
                                <span>å‘½ä¸­ç‡: ${record.accuracy}%</span>
                                <span>æ—¥æœŸ: ${date}</span>
                            </div>
                        </div>
                        <div class="score-display">${record.score}</div>
                    </div>
                `;
            });
            
            leaderboardContent.innerHTML = html;
        }

        function getDifficultyText(difficulty) {
            const diffMap = { easy: 'ç°¡å–®', medium: 'ä¸­ç­‰', hard: 'å›°é›£' };
            return diffMap[difficulty] || difficulty;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ç°¡å–®çš„IPç²å–ï¼ˆç”¨æ–¼é˜²ä½œå¼Šï¼‰
        function getClientIP() {
            // ç°¡åŒ–ç‰ˆæœ¬ï¼Œå¯¦éš›ä½¿ç”¨ä¸­å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æœå‹™
            return 'unknown';
        }

        // ç°¡å–®çš„é›œæ¹Šå‡½æ•¸
        async function getSimpleHash(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str + new Date().toDateString());
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').substring(0, 8);
        }

        // è¼‰å…¥ç©å®¶åç¨±
        function loadPlayerName() {
            try {
                const savedName = localStorage.getItem('shootingGamePlayerName');
                if (savedName) {
                    playerNameInput.value = savedName;
                }
            } catch (error) {
                console.error('è¼‰å…¥ç©å®¶åç¨±å¤±æ•—:', error);
            }
        }




        function pauseGame() {
            if (!isPlaying || isPaused) return;
            
            isPaused = true;
            clearInterval(gameInterval);

            document.getElementById('pause-overlay').style.display = 'flex';

            document.getElementById('pause-game-button').textContent = 'ç¹¼çºŒ';
        }

        function resumeGame() {
            if (!isPlaying || !isPaused) return;
            
            isPaused = false;

            document.getElementById('pause-overlay').style.display = 'none';

            document.getElementById('pause-game-button').textContent = 'æš«åœ';

            gameInterval = setInterval(() => {
                timeLeft--;
                timeLeftDisplay.textContent = timeLeft;

                if (timeLeft <= 10) {
                    timeLeftDisplay.classList.add('time-warning');
                }
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        document.getElementById('pause-game-button').addEventListener('click', function() {
            if (isPaused) {
                resumeGame();
            } else {
                pauseGame();
            }
        });

        document.getElementById('resume-button').addEventListener('click', resumeGame);

        document.getElementById('pause-end-game').addEventListener('click', endGame);


        document.getElementById('settings-button').addEventListener('click', function() {
            const settingsPanel = document.getElementById('settings-panel');
            settingsPanel.classList.toggle('show-settings');

            if (settingsPanel.classList.contains('show-settings')) {
                setupMoveTypeButtons();
                setupColorOptions();
            }
        });

        function setBgColor(color) {
            bgColor = color;

            document.querySelector('.game-container').style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -20)})`;

            saveColorSettings();
        }

        function setTargetColor(color) {
            targetColor = color;

            const target = getTarget();
            if (gameMode === "human") {

                document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                    el.style.backgroundColor = color;
                });
            } else {

                if (target) {
                    target.style.background = `radial-gradient(circle, white 10%, ${color} 10%, ${color} 30%, white 30%, white 50%, ${adjustColor(color, -20)} 50%, ${adjustColor(color, -20)} 70%, white 70%)`;
                }
            }

            saveColorSettings();
        }

        function saveColorSettings() {
            try {
                localStorage.setItem('shootingGameBgColor', bgColor);
                localStorage.setItem('shootingGameTargetColor', targetColor);
            } catch (e) {
                console.error('ä¿å­˜é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }

        function loadColorSettings() {
            try {
                const savedBgColor = localStorage.getItem('shootingGameBgColor');
                const savedTargetColor = localStorage.getItem('shootingGameTargetColor');
                
                if (savedBgColor) {
                    bgColor = savedBgColor;
                }
                
                if (savedTargetColor) {
                    targetColor = savedTargetColor;
                }

                setBgColor(bgColor);
                setTargetColor(targetColor);
            } catch (e) {
                console.error('è¼‰å…¥é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }

        function adjustColor(color, amount) {

            let r = parseInt(color.substring(1, 3), 16);
            let g = parseInt(color.substring(3, 5), 16);
            let b = parseInt(color.substring(5, 7), 16);

            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));

            return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function handleHeadClick(e) {
            if (!isPlaying || isPaused) return; 

            e.preventDefault();

            e.stopPropagation();

            shotsFired++;
            shotsHit++;

            score++;
            scoreDisplay.textContent = score;

            playSound('hit');

            createBulletHole(e.clientX, e.clientY);

            createHitEffect(this);

            createParticles(e.clientX, e.clientY, '#4cc9f0');

            updateCombo();

            screenShake(false);

            placeTargetRandomly();
        }

        function handleHeadTouchStart(e) {
            if (!isPlaying) return;

            e.preventDefault();

            e.stopPropagation();

            const touch = e.touches[0];

            shotsFired++;
            shotsHit++;

            score++;
            scoreDisplay.textContent = score;

            playSound('hit');

            createBulletHole(touch.clientX, touch.clientY);

            createHitEffect(this);

            createParticles(touch.clientX, touch.clientY, '#4cc9f0');

            updateCombo();

            screenShake(false);

            placeTargetRandomly();
        }

        function handleTargetClick(e) {
            if (!isPlaying || isPaused) return; 

            e.preventDefault();

            shotsFired++;
            shotsHit++;

            score++;
            scoreDisplay.textContent = score;

            playSound('hit');

            createBulletHole(e.clientX, e.clientY);

            createHitEffect(this);

            createParticles(e.clientX, e.clientY, '#4cc9f0');

            updateCombo();

            screenShake(false);

            placeTargetRandomly();
        }

        function handleTargetTouchStart(e) {
            if (!isPlaying) return;

            e.preventDefault();

            const touch = e.touches[0];

            shotsFired++;
            shotsHit++;

            score++;
            scoreDisplay.textContent = score;

            playSound('hit');

            createBulletHole(touch.clientX, touch.clientY);

            createHitEffect(this);

            createParticles(touch.clientX, touch.clientY, '#4cc9f0');

            updateCombo();

            screenShake(false);

            placeTargetRandomly();
        }

        gameContainer.addEventListener('mousedown', function(e) {
            if (!isPlaying || isPaused) return; 

            e.preventDefault();

            if (e.target.closest('.target') || 
                e.target.closest('.info-panel') || 
                e.target.closest('.settings-panel') ||
                e.target.closest('.settings-toggle') ||
                e.target.closest('.pause-overlay') ||
                e.target.closest('.combo-display')) return;

            shotsFired++;

            playSound('miss');

            createBulletHole(e.clientX, e.clientY);

            screenShake(true);

            resetCombo();

            if (score > 0) {
                score--;
                scoreDisplay.textContent = score;
                showFloatingText('-1åˆ†', e.clientX, e.clientY, 'penalty-text');
            }
        });

        gameContainer.addEventListener('touchstart', function(e) {
            if (!isPlaying || isPaused) return; 

            if (e.target.closest('.target') || 
                e.target.closest('.info-panel') || 
                e.target.closest('.settings-panel') ||
                e.target.closest('.settings-toggle') ||
                e.target.closest('.pause-overlay') ||
                e.target.closest('.combo-display')) return;

            e.preventDefault();

            const touch = e.touches[0];

            shotsFired++;

            playSound('miss');

            createBulletHole(touch.clientX, touch.clientY);

            screenShake(true);

            resetCombo();

            if (score > 0) {
                score--;
                scoreDisplay.textContent = score;
                showFloatingText('-1åˆ†', touch.clientX, touch.clientY, 'penalty-text');
            }
        });

        function updateCombo() {
            const now = Date.now();

            if (now - lastHitTime < 1500) {
                combo++;
            } else {
                combo = 1;
            }
            
            lastHitTime = now;

            if (combo > maxCombo) {
                maxCombo = combo;
            }

            comboDisplay.style.display = 'flex';
            comboCountDisplay.textContent = combo;

            if (combo >= 10 && combo % 10 === 0) {
                score++;
                bonusPoints++;
                scoreDisplay.textContent = score;
                showBonusText();
            }

            if (combo > 1) {
                showComboText();
            }
        }

        function resetCombo() {
            combo = 0;
            comboCountDisplay.textContent = combo;
            comboDisplay.style.display = 'none';
        }

        function showComboText() {
            const target = getTarget();
            const rect = target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top;
            showFloatingText(`${combo}é€£æ“Šï¼`, x, y, 'combo-text');
        }

        function showBonusText() {
            const target = getTarget();
            const rect = target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top - 30;
            showFloatingText('+1åˆ†çå‹µï¼', x, y, 'bonus-text');
        }

        function showNewRecord() {
            const newRecord = document.createElement('div');
            newRecord.classList.add('new-record');
            newRecord.textContent = 'æ–°ç´€éŒ„ï¼';
            endScreen.appendChild(newRecord);
            
            setTimeout(() => {
                newRecord.remove();
            }, 3000);
        }

        function showFloatingText(text, x, y, className) {
            const floatingText = document.createElement('div');
            floatingText.classList.add('floating-text', className);
            floatingText.textContent = text;

            const rect = gameContainer.getBoundingClientRect();

            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            floatingText.style.left = `${relativeX}px`;
            floatingText.style.top = `${relativeY}px`;
            gameContainer.appendChild(floatingText);
            
            setTimeout(() => {
                floatingText.remove();
            }, 1000);
        }

        function createBulletHole(x, y) {
            const bulletHole = document.createElement('div');
            bulletHole.classList.add('bullet-hole');

            const rect = gameContainer.getBoundingClientRect();

            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            bulletHole.style.left = `${relativeX}px`;
            bulletHole.style.top = `${relativeY}px`;
            gameContainer.appendChild(bulletHole);

            playSound('shot');

            setTimeout(() => {
                bulletHole.remove();
            }, 3000);
        }

        function createHitEffect(element) {
            element.classList.add('hit-flash');
            setTimeout(() => {
                element.classList.remove('hit-flash');
            }, 200);
        }

        function createParticles(x, y, color) {
            const particleCount = 10;

            const rect = gameContainer.getBoundingClientRect();

            const relativeX = x - rect.left;
            const relativeY = y - rect.top;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');

                const size = Math.random() * 5 + 3;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                particle.style.backgroundColor = color;

                particle.style.left = `${relativeX}px`;
                particle.style.top = `${relativeY}px`;

                gameContainer.appendChild(particle);

                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;

                let posX = relativeX;
                let posY = relativeY;
                
                const animate = () => {

                    posX += vx;
                    posY += vy;

                    particle.style.left = `${posX}px`;
                    particle.style.top = `${posY}px`;

                    particle.style.opacity = parseFloat(particle.style.opacity || 1) - 0.02;
                    
                    if (parseFloat(particle.style.opacity) > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                
                requestAnimationFrame(animate);
            }
        }

        function screenShake(isLight) {
            if (isLight) {
                gameContainer.classList.add('screen-shake-light');
                setTimeout(() => {
                    gameContainer.classList.remove('screen-shake-light');
                }, 200);
            } else {
                gameContainer.classList.add('screen-shake');
                setTimeout(() => {
                    gameContainer.classList.remove('screen-shake');
                }, 300);
            }
        }

        // æ’è¡Œæ¦œäº‹ä»¶ç›£è½å™¨
        leaderboardButton.addEventListener('click', function() {
            homeScreen.style.display = 'none';
            leaderboardScreen.style.display = 'flex';
            loadLeaderboard('all');
        });

        closeLeaderboardButton.addEventListener('click', function() {
            leaderboardScreen.style.display = 'none';
            homeScreen.style.display = 'flex';
        });

        // æ’è¡Œæ¦œç¯©é¸æŒ‰éˆ•
        document.getElementById('filter-all').addEventListener('click', function() {
            setActiveFilter('filter-all');
            loadLeaderboard('all');
        });

        document.getElementById('filter-human').addEventListener('click', function() {
            setActiveFilter('filter-human');
            loadLeaderboard('human');
        });

        document.getElementById('filter-circle').addEventListener('click', function() {
            setActiveFilter('filter-circle');
            loadLeaderboard('circle');
        });

        document.getElementById('filter-today').addEventListener('click', function() {
            setActiveFilter('filter-today');
            loadLeaderboard('today');
        });

        function setActiveFilter(activeId) {
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(activeId).classList.add('active');
        }

        playButton.addEventListener('click', showStartScreen);

        startButton.addEventListener('click', startGame);

        restartButton.addEventListener('click', startGame);

        homeButton.addEventListener('click', showHome);

        backToHomeButton.addEventListener('click', showHome);

        document.getElementById('end-game-button').addEventListener('click', endGame);

        instructionsButton.addEventListener('click', showInstructions);

        backFromInstructionsButton.addEventListener('click', showHome);

        document.addEventListener('keydown', function(e) {

            if (e.key === 'Escape' && isPlaying) {
                endGame();
            }
        });

        homeToggleModeButton.addEventListener('click', function() {

            gameMode = gameMode === "human" ? "target" : "human";

            homeToggleModeButton.textContent = 
                gameMode === "human" ? "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼" : "åˆ‡æ›è‡³äººå½¢æ¨¡å¼";

            currentModeDisplay.textContent = gameMode === "human" ? "äººå½¢é¶å­" : "é¶å¿ƒ";

            setupTargetByMode();
        });

        function setupColorOptions() {

            const bgColorOptions = document.querySelectorAll('#bg-color-options .color-option');
            bgColorOptions.forEach(option => {

                if (option.getAttribute('data-color') === bgColor) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }

                option.addEventListener('click', function() {

                    bgColorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    const color = this.getAttribute('data-color');

                    setBgColor(color);

                    document.getElementById('bg-color-custom').value = color;
                });
            });

            const targetColorOptions = document.querySelectorAll('#target-color-options .color-option');
            targetColorOptions.forEach(option => {

                if (option.getAttribute('data-color') === targetColor) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }

                option.addEventListener('click', function() {

                    targetColorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    const color = this.getAttribute('data-color');

                    setTargetColor(color);

                    document.getElementById('target-color-custom').value = color;
                });
            });

            document.getElementById('bg-color-apply').addEventListener('click', function() {
                const customColor = document.getElementById('bg-color-custom').value;

                bgColorOptions.forEach(opt => opt.classList.remove('active'));

                let matchFound = false;
                bgColorOptions.forEach(opt => {
                    if (opt.getAttribute('data-color') === customColor) {
                        opt.classList.add('active');
                        matchFound = true;
                    }
                });

                setBgColor(customColor);
            });

            document.getElementById('target-color-apply').addEventListener('click', function() {
                const customColor = document.getElementById('target-color-custom').value;

                targetColorOptions.forEach(opt => opt.classList.remove('active'));

                let matchFound = false;
                targetColorOptions.forEach(opt => {
                    if (opt.getAttribute('data-color') === customColor) {
                        opt.classList.add('active');
                        matchFound = true;
                    }
                });

                setTargetColor(customColor);
            });

            document.getElementById('bg-color-custom').value = bgColor;
            document.getElementById('target-color-custom').value = targetColor;
        }

        function setBgColor(color) {
            bgColor = color;

            document.querySelector('.game-container').style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -20)})`;

            saveColorSettings();
        }

        function setTargetColor(color) {
            targetColor = color;

            const target = getTarget();
            if (gameMode === "human") {

                document.querySelectorAll('.head, .body, .arm-left, .arm-right, .leg-left, .leg-right').forEach(el => {
                    el.style.backgroundColor = color;
                });
            } else {

                if (target) {
                    target.style.background = `radial-gradient(circle, white 10%, ${color} 10%, ${color} 30%, white 30%, white 50%, ${adjustColor(color, -20)} 50%, ${adjustColor(color, -20)} 70%, white 70%)`;
                }
            }

            saveColorSettings();
        }

        function saveColorSettings() {
            try {
                localStorage.setItem('shootingGameBgColor', bgColor);
                localStorage.setItem('shootingGameTargetColor', targetColor);
            } catch (e) {
                console.error('ä¿å­˜é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }

        function loadColorSettings() {
            try {
                const savedBgColor = localStorage.getItem('shootingGameBgColor');
                const savedTargetColor = localStorage.getItem('shootingGameTargetColor');
                
                if (savedBgColor) {
                    bgColor = savedBgColor;
                }
                
                if (savedTargetColor) {
                    targetColor = savedTargetColor;
                }

                setBgColor(bgColor);
                setTargetColor(targetColor);
            } catch (e) {
                console.error('è¼‰å…¥é¡è‰²è¨­å®šå¤±æ•—:', e);
            }
        }

        function adjustColor(color, amount) {

            let r = parseInt(color.substring(1, 3), 16);
            let g = parseInt(color.substring(3, 5), 16);
            let b = parseInt(color.substring(5, 7), 16);

            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));

            return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        
        document.getElementById('close-settings').addEventListener('click', function() {
            document.getElementById('settings-panel').classList.remove('show-settings');
        });

        document.getElementById('easy-button').addEventListener('click', function() {
            setDifficulty('easy');
            updateDifficultyButtons('easy');
        });
        
        document.getElementById('medium-button').addEventListener('click', function() {
            setDifficulty('medium');
            updateDifficultyButtons('medium');
        });
        
        document.getElementById('hard-button').addEventListener('click', function() {
            setDifficulty('hard');
            updateDifficultyButtons('hard');
        });

        function setMoveType(type) {
            moveType = type;
            console.log(`ç§»å‹•æ–¹å¼å·²è¨­ç½®ç‚º: ${type}`);

            const moveTypeDisplay = document.getElementById('current-move-type');
            if (moveTypeDisplay) {
                moveTypeDisplay.textContent = type === 'transition' ? 'æ¼¸è®Šç§»å‹•' : 'ç¬é–“ç§»å‹•';
            } else {
                console.error('æ‰¾ä¸åˆ°ç§»å‹•æ–¹å¼é¡¯ç¤ºå…ƒç´ ');
            }

            if (isPlaying) {
                const targetElement = getTarget();
                if (targetElement) {
                    targetElement.style.transition = type === 'transition' 
                        ? `left ${difficulties[currentDifficulty].targetSpeed}ms, top ${difficulties[currentDifficulty].targetSpeed}ms`
                        : 'none';
                }
            }
        }

        document.getElementById('volume-control').addEventListener('input', function(e) {
            soundSettings.volume = parseFloat(e.target.value);

            Object.values(sounds).forEach(sound => {
                sound.volume = soundSettings.volume;
            });
        });

        document.getElementById('mute-toggle').addEventListener('change', function(e) {
            soundSettings.muted = e.target.checked;

            Object.values(sounds).forEach(sound => {
                sound.muted = soundSettings.muted;
            });
        });

        document.getElementById('toggle-mode-button').textContent = "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼";
        homeToggleModeButton.textContent = "åˆ‡æ›è‡³é¶å¿ƒæ¨¡å¼";

        document.addEventListener('DOMContentLoaded', function() {

            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });

            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
            });

            initSounds();

            setTimeout(() => {

                const shotSound = document.getElementById('sound-shot');
                if (shotSound && shotSound.src) {
                    console.log('å°„æ“ŠéŸ³æ•ˆå·²è¼‰å…¥:', shotSound.src);

                    shotSound.load();
                } else {
                    console.error('æ‰¾ä¸åˆ°å°„æ“ŠéŸ³æ•ˆå…ƒç´ æˆ–å…¶æºæ–‡ä»¶');
                }
            }, 500); 

            loadColorSettings();
            
            // è¼‰å…¥ç©å®¶åç¨±
            loadPlayerName();

            initGame();


            setupColorOptions();

            adjustGameContainerSize();

            window.addEventListener('resize', adjustGameContainerSize);

            showHome();

            setTimeout(setupMoveTypeButtons, 500);

            console.log('éŠæˆ²åˆå§‹åŒ–å®Œæˆ');
        });

        function adjustGameContainerSize() {

            gameContainer.style.width = `${window.innerWidth}px`;
            gameContainer.style.height = `${window.innerHeight}px`;

            document.body.style.overflow = 'hidden';
            document.documentElement.style.overflow = 'hidden';

            document.body.style.webkitTouchCallout = 'none'; 
            document.body.style.webkitUserSelect = 'none';   
            document.body.style.khtmlUserSelect = 'none';    
            document.body.style.mozUserSelect = 'none';      
            document.body.style.msUserSelect = 'none';       
            document.body.style.userSelect = 'none';         

            if (isPlaying && !isPaused) {
                placeTargetRandomly();
            }
        }

        function setupMoveTypeButtons() {

            function updateMoveTypeButtons(activeType) {
                document.querySelectorAll('.move-button').forEach(button => {
                    button.classList.remove('active');
                });
                document.getElementById(`${activeType}-move`).classList.add('active');
            }

            const transitionButton = document.getElementById('transition-move');
            const instantButton = document.getElementById('instant-move');
            
            if (transitionButton && instantButton) {

                transitionButton.addEventListener('click', function() {
                    setMoveType('transition');
                    updateMoveTypeButtons('transition');
                    console.log('è¨­ç½®ç‚ºæ¼¸è®Šç§»å‹•');
                });
                
                instantButton.addEventListener('click', function() {
                    setMoveType('instant');
                    updateMoveTypeButtons('instant');
                    console.log('è¨­ç½®ç‚ºç¬é–“ç§»å‹•');
                });
            } else {
                console.error('æ‰¾ä¸åˆ°ç§»å‹•æ–¹å¼æŒ‰éˆ•');
            }
        }

        function placeTargetRandomly() {
            const target = getTarget();
            if (!target) return;

            const gameContainer = document.getElementById('game-container');
            const containerWidth = gameContainer.clientWidth;
            const containerHeight = gameContainer.clientHeight;

            const targetWidth = target.offsetWidth;
            const targetHeight = target.offsetHeight;

            const maxX = containerWidth - targetWidth;
            const maxY = containerHeight - targetHeight;

            const minY = 70; 

            let randomX = Math.floor(Math.random() * maxX);
            let randomY = Math.floor(Math.random() * (maxY - minY)) + minY;

            if (moveType === 'transition') {
                target.style.transition = `left ${difficulties[currentDifficulty].targetSpeed}ms, top ${difficulties[currentDifficulty].targetSpeed}ms`;
            } else {
                target.style.transition = 'none';
            }

            target.style.left = `${randomX}px`;
            target.style.top = `${randomY}px`;
        }
    </script>
</body>
</html>
